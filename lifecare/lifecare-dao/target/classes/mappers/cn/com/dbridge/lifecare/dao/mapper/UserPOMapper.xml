<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.com.dbridge.lifecare.dao.respository.UserPOMapper" >
  <resultMap id="BaseResultMap" type="cn.com.dbridge.lifecare.dao.po.UserPO" >
    <id column="USER_ID" property="userId" jdbcType="INTEGER" />
    <result column="USER_NUMBER" property="userNumber" jdbcType="VARCHAR" />
    <result column="PASSWORD" property="password" jdbcType="VARCHAR" />
    <result column="DICT_TYPE_CODE" property="dictTypeCode" jdbcType="VARCHAR" />
    <result column="USER_TYPE" property="userType" jdbcType="VARCHAR" />
    <result column="REAL_NAME" property="realName" jdbcType="VARCHAR" />
    <result column="IMG" property="img" jdbcType="VARCHAR" />
    <result column="WECHAT_NICK_NAME" property="wechatNickName" jdbcType="VARCHAR" />
    <result column="OPEN_ID" property="openId" jdbcType="VARCHAR" />
    <result column="UNION_ID" property="unionId" jdbcType="VARCHAR" />
    <result column="MOBILE" property="mobile" jdbcType="VARCHAR" />
    <result column="EMAIL" property="email" jdbcType="VARCHAR" />
    <result column="BIRTHDAY" property="birthday" jdbcType="DATE" />
    <result column="PROVINCE_ID" property="provinceId" jdbcType="INTEGER" />
    <result column="CITY_ID" property="cityId" jdbcType="INTEGER" />
    <result column="DISTRICT_ID" property="districtId" jdbcType="INTEGER" />
    <result column="STREET_VILLAGE" property="streetVillage" jdbcType="VARCHAR" />
    <result column="BUILDING_NO" property="buildingNo" jdbcType="VARCHAR" />
    <result column="USERADDR" property="userAddr" jdbcType="VARCHAR" />
    <result column="SEX" property="sex" jdbcType="TINYINT" />
    <result column="USER_STATUS" property="userStatus" jdbcType="TINYINT" />
    <result column="ID_CARD" property="idCard" jdbcType="VARCHAR" />
    <result column="EMERGENCY_CONTACT_A" property="emergencyContactA" jdbcType="VARCHAR" />
    <result column="RELATION_WITH_A" property="relationWithA" jdbcType="VARCHAR" />
    <result column="EMERGENCY_CONTACT_B" property="emergencyContactB" jdbcType="VARCHAR" />
    <result column="RELATION_WITH_B" property="relationWithB" jdbcType="VARCHAR" />
    <result column="USER_LEVEL" property="userLevel" jdbcType="VARCHAR" />
    <result column="BACK_INFO" property="backInfo" jdbcType="VARCHAR" />
    <result column="REMARKS" property="remarks" jdbcType="VARCHAR" />
    <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
    <result column="CREATE_BY" property="createBy" jdbcType="INTEGER" />
    <result column="UPDATE_TIME" property="updateTime" jdbcType="TIMESTAMP" />
    <result column="UPDATE_BY" property="updateBy" jdbcType="INTEGER" />
    <result column="SERVICE_CATEGORY_LEVEL" property="serviceCategoryLevel" jdbcType="VARCHAR" />
    <result column="DRAFT_NURSE_PLAN" property="draftNursePlan" jdbcType="TINYINT" />
  </resultMap>
  <resultMap id="MyInfoResultMap" type="cn.com.dbridge.lifecare.dao.po.MobileMyInfoPO" >
    <id column="USER_ID" property="userId" jdbcType="INTEGER" />
    <result column="IMG" property="img" jdbcType="VARCHAR" />
    <result column="REAL_NAME" property="realName" jdbcType="VARCHAR" />
    <result column="ID_CARD" property="idCard" jdbcType="VARCHAR" />
    <result column="USER_NUMBER" property="userNumber" jdbcType="VARCHAR" />
    <result column="USER_TYPE" property="userType" jdbcType="VARCHAR" />
    <result column="BIRTHDAY" property="birthday" jdbcType="DATE" />
    <result column="MOBILE" property="mobile" jdbcType="VARCHAR" />
    <result column="PROVINCE_ID" property="provinceId" jdbcType="INTEGER" />
    <result column="PROVINCE_NAME" property="provinceName" jdbcType="VARCHAR" />
    <result column="CITY_ID" property="cityId" jdbcType="INTEGER" />
    <result column="CITY_NAME" property="cityName" jdbcType="VARCHAR" />
    <result column="DISTRICT_ID" property="districtId" jdbcType="INTEGER" />
    <result column="DISTRICT_NAME" property="districtName" jdbcType="VARCHAR" />
    <result column="STREET_VILLAGE" property="streetVillage" jdbcType="VARCHAR" />
    <result column="BUILDING_NO" property="buildingNo" jdbcType="VARCHAR" />
    <result column="EMAIL" property="email" jdbcType="VARCHAR" />
    <result column="WECHAT_NICK_NAME" property="wechatNickName" jdbcType="VARCHAR" />
    <result column="OPEN_ID" property="openId" jdbcType="VARCHAR" />
  </resultMap>
  
  <resultMap id="WebUserManageResultMap" type="cn.com.dbridge.lifecare.dao.po.WebUserManagePO" >
    <id column="USER_ID" property="userId" jdbcType="INTEGER" />
    <result column="USER_NUMBER" property="userNumber" jdbcType="VARCHAR" />
    <result column="ID_CARD" property="idCard" jdbcType="VARCHAR" />   
    <result column="REAL_NAME" property="realName" jdbcType="VARCHAR" />   
    <result column="MOBILE" property="mobile" jdbcType="VARCHAR" />
    <result column="BIRTHDAY" property="birthday" jdbcType="DATE" />
    <result column="USER_TYPE" property="userType" jdbcType="TINYINT" /> 
    <result column="USER_ADDR" property="userAddr" jdbcType="VARCHAR" />              
    <result column="SEX" property="sex" jdbcType="TINYINT" />  
    <result column="SERVICE_CATEGORY_LEVEL" property="serviceCategoryLevel" jdbcType="VARCHAR" />
    <result column="USER_LEVEL" property="userLevel" jdbcType="VARCHAR" />
    <result column="USER_STATUS" property="userStatus" jdbcType="TINYINT" />    
   </resultMap> 
 
   <resultMap id="WebUserResultMap" type="cn.com.dbridge.lifecare.dao.po.WebUserPO" >
    <id column="USER_ID" property="userId" jdbcType="INTEGER" />
    <result column="USER_NUMBER" property="userNumber" jdbcType="VARCHAR" />
    <result column="PASSWORD" property="password" jdbcType="VARCHAR" />
    <result column="REAL_NAME" property="realName" jdbcType="VARCHAR" />
    <result column="IMG" property="img" jdbcType="VARCHAR" />
    <result column="MOBILE" property="mobile" jdbcType="VARCHAR" />
    <result column="EMAIL" property="email" jdbcType="VARCHAR" />
    <result column="BIRTHDAY" property="birthday" jdbcType="DATE" />
    <result column="PROVINCE_ID" property="provinceId" jdbcType="INTEGER" />
    <result column="CITY_ID" property="cityId" jdbcType="INTEGER" />
    <result column="DISTRICT_ID" property="districtId" jdbcType="INTEGER" />
    <result column="STREET_VILLAGE" property="streetVillage" jdbcType="VARCHAR" />
    <result column="BUILDING_NO" property="buildingNo" jdbcType="VARCHAR" />
    <result column="SEX" property="sex" jdbcType="TINYINT" />
    <result column="USER_STATUS" property="userStatus" jdbcType="TINYINT" />
    <result column="ID_CARD" property="idCard" jdbcType="VARCHAR" />
    <result column="EMERGENCY_CONTACT_A" property="emergencyContactA" jdbcType="VARCHAR" />
    <result column="RELATION_WITH_A" property="relationWithA" jdbcType="VARCHAR" />
    <result column="EMERGENCY_CONTACT_B" property="emergencyContactB" jdbcType="VARCHAR" />
    <result column="RELATION_WITH_B" property="relationWithB" jdbcType="VARCHAR" />
    <result column="SERVICE_CATEGORY_LEVEL" property="serviceCategoryLevel" jdbcType="VARCHAR" />
    <result column="DRAFT_NURSE_PLAN" property="draftNursePlan" jdbcType="TINYINT" />
    <result column="USER_LEVEL" property="userLevel" jdbcType="VARCHAR" />
    <result column="BACK_INFO" property="backInfo" jdbcType="VARCHAR" />
    <result column="REMARKS" property="remarks" jdbcType="VARCHAR" />
    <result column="USER_TYPE" property="userType" jdbcType="INTEGER" />
  </resultMap>       
  
  <select id="queryUsersInfo" resultMap="WebUserManageResultMap" parameterType="cn.com.dbridge.lifecare.dao.po.WebUserManagePO" >
    select 
        A.USER_ID,
        A.USER_NUMBER,
        A.REAL_NAME,
        A.MOBILE,
        CONCAT(B.DISTRICT_NAME,A.STREET_VILLAGE,A.BUILDING_NO) USER_ADDR,
        A.BIRTHDAY,
        A.SEX,
        A.SERVICE_CATEGORY_LEVEL,
        A.USER_LEVEL,               
        A.USER_STATUS
    from t_user A left join t_district B
             on A.CITY_ID = B.CITY_ID 
                 AND A.DISTRICT_ID = B.DISTRICT_ID
    <where>
        <if test="userNumber != null and userNumber != ''">
            AND A.USER_NUMBER like concat(concat('%',#{userNumber,jdbcType=VARCHAR}),'%')
        </if>
         <if test="idCard != null and idCard != ''">
            AND A.ID_CARD = #{idCard,jdbcType=VARCHAR}
        </if>       
        <if test="realName != null and realName != ''">
            AND A.REAL_NAME = #{realName,jdbcType=VARCHAR}
        </if>        
          <if test="mobile != null and mobile != ''">
            AND A.MOBILE = #{mobile,jdbcType=VARCHAR}
        </if>
        <if test="birthday != null">
            AND A.BIRTHDAY = #{birthday,jdbcType=DATE}
        </if> 
         <if test="userLevel != null and userLevel != '' ">
            AND A.USER_LEVEL = #{userLevel,jdbcType=VARCHAR}
        </if>     
        <if test="userType != null">
            AND  A.USER_TYPE = #{userType,jdbcType=TINYINT}
        </if> 
        <if test="userStatus != null">
            AND A.USER_STATUS = #{userStatus,jdbcType=TINYINT}
        </if>  
        <if test="sex != null">
            AND A.SEX = #{sex,jdbcType=TINYINT}
        </if>  
        <if test="draftNursePlan != null">
            AND A.DRAFT_NURSE_PLAN = #{draftNursePlan,jdbcType=TINYINT}
        </if> 
        
        <if test='serviceCategoryCode != null and serviceCategoryCode == "A" '>
            AND RIGHT(A.SERVICE_CATEGORY_LEVEL, 1) = '1'
        </if>
        <if test='serviceCategoryCode != null and serviceCategoryCode == "B" '>
             AND SUBSTR(A.SERVICE_CATEGORY_LEVEL FROM 2 FOR 1) = '1'
        </if>             
        <if test='serviceCategoryCode != null and serviceCategoryCode == "C" '>
            AND LEFT(A.SERVICE_CATEGORY_LEVEL, 1) = '1'
        </if>         
         <if test="orderDate != null and orderBeginTime != null and orderEndTime != null ">
             AND NOT EXISTS (
                 SELECT 1 
                 FROM T_TASK T 
                 WHERE T.SERVICE_PERSON_ID = A.USER_ID
                  AND T.ORDER_STATUS in (2, 5)
                  AND T.ORDER_DATE = #{orderDate,jdbcType=DATE}
                  AND (
                        (
             T.ORDER_BEGIN_TIME <![CDATA[>=]]> #{orderBeginTime,jdbcType=TIME}
                          AND T.ORDER_BEGIN_TIME <![CDATA[<=]]> #{orderEndTime,jdbcType=TIME} 
                         )
                         OR
                         (
                          T.ORDER_END_TIME <![CDATA[>=]]> #{orderBeginTime,jdbcType=TIME} 
                          AND T.ORDER_END_TIME <![CDATA[<=]]> #{orderEndTime,jdbcType=TIME}  
                         )
                         OR
                         (
                         T.ORDER_BEGIN_TIME <![CDATA[<=]]> #{orderBeginTime,jdbcType=TIME}
                         AND T.ORDER_END_TIME <![CDATA[>=]]> #{orderEndTime,jdbcType=TIME}
                         )
                      )
                ) 
        </if>  
    </where>
     <!-- 1:客户的场合 -->
    <if test="userType != null and userType == 1">
        order by A.REAL_NAME_PINYIN, A.REAL_NAME
    </if>     
    <!-- 2:服务人员的场合 -->
    <if test="userType != null and userType == 2">
        order by CONCAT(LEFT(A.USER_NUMBER, 1), A.REAL_NAME_PINYIN), A.REAL_NAME 
    </if>
    <!-- 3:后台用户的场合 -->
    <if test="userType != null and userType == 3">
        order by CONCAT(LEFT(A.USER_NUMBER, 1), A.REAL_NAME_PINYIN), A.REAL_NAME 
    </if>
  </select>  
   
 <select id="getUserInfoByUserId" resultMap="WebUserResultMap" parameterType="java.lang.Integer" >
    select 
        USER_ID,
        USER_NUMBER,
        PASSWORD,
        IMG,
        REAL_NAME,
        MOBILE,
        SEX,
        PROVINCE_ID,
        CITY_ID,
        DISTRICT_ID,
        STREET_VILLAGE,
        BUILDING_NO,
        ID_CARD,
        BIRTHDAY,
        EMERGENCY_CONTACT_A,
        RELATION_WITH_A,
        EMERGENCY_CONTACT_B,
        RELATION_WITH_B,
        REMARKS,
        BACK_INFO,
        SERVICE_CATEGORY_LEVEL,
        DRAFT_NURSE_PLAN,        
        USER_LEVEL,
        USER_STATUS,
        USER_TYPE
    from t_user 
    where
        USER_ID = #{userId,jdbcType=INTEGER}                
  </select>  
  
  <update id="updateUserInfoByUserId" parameterType="cn.com.dbridge.lifecare.dao.po.WebUserPO" >
   update t_user
    <set >
      <if test="userNumber != null" >
        USER_NUMBER = #{userNumber,jdbcType=VARCHAR},
      </if>  
      <if test="password != null" >
        PASSWORD = #{password,jdbcType=VARCHAR},
      </if>       
      <if test="realName != null" >
        REAL_NAME = #{realName,jdbcType=VARCHAR},
      </if>
      <if test="realNamePinyin != null" >
        REAL_NAME_PINYIN = #{realNamePinyin,jdbcType=VARCHAR},
      </if>
      <if test="img != null" >
        IMG = #{img,jdbcType=VARCHAR},
      </if>
      <if test="mobile != null" >
        MOBILE = #{mobile,jdbcType=VARCHAR},
      </if>
      <if test="birthday != null" >
        BIRTHDAY = #{birthday,jdbcType=DATE},
      </if>
      <if test="provinceId != null" >
        PROVINCE_ID = #{provinceId,jdbcType=INTEGER},
      </if>
      <if test="cityId != null" >
        CITY_ID = #{cityId,jdbcType=INTEGER},
      </if>
      <if test="districtId != null" >
        DISTRICT_ID = #{districtId,jdbcType=INTEGER},
      </if>
      <if test="streetVillage != null" >
        STREET_VILLAGE = #{streetVillage,jdbcType=VARCHAR},
      </if>
      <if test="streetVillagePinyin != null" >
        STREET_VILLAGE_PINYIN = #{streetVillagePinyin,jdbcType=VARCHAR},
      </if>
      <if test="buildingNo != null" >
        BUILDING_NO = #{buildingNo,jdbcType=VARCHAR},
      </if>
      <if test="sex != null" >
        SEX = #{sex,jdbcType=TINYINT},
      </if>
      <if test="userStatus != null" >
        USER_STATUS = #{userStatus,jdbcType=TINYINT},
      </if>
      <if test="idCard != null" >
        ID_CARD = #{idCard,jdbcType=VARCHAR},
      </if>
      <if test="relationWithA != null" >
        RELATION_WITH_A = #{relationWithA,jdbcType=VARCHAR},
      </if>
       <if test="emergencyContactA != null" >
        EMERGENCY_CONTACT_A = #{emergencyContactA,jdbcType=VARCHAR},
      </if>
      <if test="emergencyContactB != null" >
        EMERGENCY_CONTACT_B = #{emergencyContactB,jdbcType=VARCHAR},
      </if>
      <if test="relationWithB != null" >
        RELATION_WITH_B = #{relationWithB,jdbcType=VARCHAR},
      </if>
      <if test="serviceCategoryLevel != null" >
        SERVICE_CATEGORY_LEVEL = #{serviceCategoryLevel,jdbcType=VARCHAR},
      </if>
      <if test="draftNursePlan != null" >
        DRAFT_NURSE_PLAN = #{draftNursePlan,jdbcType=TINYINT},
      </if>
      <if test="userLevel != null" >
        USER_LEVEL = #{userLevel,jdbcType=VARCHAR},
      </if>
      <if test="backInfo != null" >
        BACK_INFO = #{backInfo,jdbcType=VARCHAR},
      </if>
      <if test="remarks != null" >
        REMARKS = #{remarks,jdbcType=VARCHAR},
      </if>
      <if test="remarks == null" >
        REMARKS = null,
      </if>
      <if test="updateBy != null" >
        UPDATE_BY = #{updateBy,jdbcType=INTEGER},
      </if>
       UPDATE_TIME = NOW()
    </set>
    where USER_ID = #{userId,jdbcType=INTEGER}
  </update>  
  
  <select id="getUserNumberCount" resultType="java.lang.Integer" parameterType="cn.com.dbridge.lifecare.dao.po.WebUserPO" >
   SELECT 
    COUNT(USER_ID)
   FROM
    t_user
   WHERE
    USER_NUMBER = #{userNumber,jdbcType=VARCHAR}
     <if test="userId != null">
        AND USER_ID != #{userId,jdbcType=INTEGER}
     </if>          
  </select>
  
 <select id="getNextUserNumber" resultType="java.lang.String" >
    SELECT LPAD(MAX(RIGHT(USER_NUMBER, 5)) + 1, 5, 0) AS USER_NUMBER
    FROM T_USER
    WHERE USER_TYPE = 1
     AND LENGTH(USER_NUMBER) = 8
     AND LEFT(USER_NUMBER, 3) IN('ZQM','ZQF') 
 </select> 
  
  <insert id="insertUser" parameterType="cn.com.dbridge.lifecare.dao.po.WebUserPO" >
    <selectKey resultType="java.lang.Integer" keyProperty="userId" order="AFTER" >
       SELECT LAST_INSERT_ID() 
    </selectKey>
    INSERT INTO t_user (
        USER_NUMBER,
        PASSWORD,
        DICT_TYPE_CODE,
        USER_TYPE,
        REAL_NAME,
        REAL_NAME_PINYIN,
        IMG,
        WECHAT_NICK_NAME,
        OPEN_ID,
        UNION_ID,
        MOBILE,
        BIRTHDAY,
        PROVINCE_ID,
        CITY_ID,
        DISTRICT_ID,
        STREET_VILLAGE,
        STREET_VILLAGE_PINYIN,        
        BUILDING_NO,
        SEX,
        USER_STATUS,
        ID_CARD,
        EMERGENCY_CONTACT_A,
        RELATION_WITH_A,
        EMERGENCY_CONTACT_B,
        RELATION_WITH_B,
        USER_LEVEL,
        BACK_INFO,
        REMARKS,
        SERVICE_CATEGORY_LEVEL,
        DRAFT_NURSE_PLAN,
        CREATE_TIME,
        CREATE_BY,
        UPDATE_TIME,
        UPDATE_BY 
    )
    VALUES
    ( #{userNumber,jdbcType=VARCHAR}
    , #{password,jdbcType=VARCHAR}
    , 'USER_TYPE'
    , #{userType,jdbcType=TINYINT}
    , #{realName,jdbcType=VARCHAR}
    , #{realNamePinyin,jdbcType=VARCHAR}
    , #{img,jdbcType=VARCHAR}
    , NULL
    , NULL
    , NULL
    , #{mobile,jdbcType=VARCHAR}
    , #{birthday,jdbcType=DATE}
    , #{provinceId,jdbcType=INTEGER}
    , #{cityId,jdbcType=INTEGER}
    , #{districtId,jdbcType=INTEGER}
    , #{streetVillage,jdbcType=VARCHAR}
    , #{streetVillagePinyin,jdbcType=VARCHAR}
    , #{buildingNo,jdbcType=VARCHAR}
    , #{sex,jdbcType=TINYINT}
    , #{userStatus,jdbcType=TINYINT}
    , #{idCard,jdbcType=VARCHAR}
    , #{emergencyContactA,jdbcType=VARCHAR}
    , #{relationWithA,jdbcType=VARCHAR}
    , #{emergencyContactB,jdbcType=VARCHAR}
    , #{relationWithB,jdbcType=VARCHAR}
    , #{userLevel,jdbcType=VARCHAR}
    , #{backInfo,jdbcType=VARCHAR}
    , #{remarks,jdbcType=VARCHAR}
    , #{serviceCategoryLevel,jdbcType=VARCHAR}
    , #{draftNursePlan,jdbcType=TINYINT}
    , NOW()
    , #{createBy,jdbcType=INTEGER}
    , NULL
    , NULL
    )    
  </insert>
  
  <update id="updatePasswordByUserNumber" parameterType="cn.com.dbridge.lifecare.dao.po.WebUserPO" >
   update t_user
    <set >
      <if test="password != null" >
        PASSWORD = #{password,jdbcType=VARCHAR},
      </if>          
      <if test="updateBy != null" >
        UPDATE_BY = #{updateBy,jdbcType=INTEGER},
      </if>
       UPDATE_TIME = NOW()
    </set>
    where USER_NUMBER = #{userNumber,jdbcType=VARCHAR}
  </update>  
  
  <!-- 根据主键删除 -->
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    delete from t_user
    where USER_ID = #{userId,jdbcType=INTEGER}
  </delete>
  
  <insert id="insert" parameterType="cn.com.dbridge.lifecare.dao.po.UserPO" >
    <selectKey resultType="java.lang.Integer" keyProperty="userId" order="AFTER" >
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into t_user (USER_NUMBER, PASSWORD, DICT_TYPE_CODE,USER_TYPE,REAL_NAME,
      IMG, WECHAT_NICK_NAME,OPEN_ID,UNION_ID, 
      MOBILE, BIRTHDAY, PROVINCE_ID, 
      CITY_ID, DISTRICT_ID, STREET_VILLAGE, 
      BUILDING_NO, SEX, USER_STATUS, 
      ID_CARD, EMERGENCY_CONTACT_A,RELATION_WITH_A,
      EMERGENCY_CONTACT_B,RELATION_WITH_B, 
      USER_LEVEL, BACK_INFO, REMARKS, 
      CREATE_TIME, CREATE_BY, UPDATE_TIME, 
      UPDATE_BY)
    values (#{userNumber,jdbcType=VARCHAR}, #{password,jdbcType=VARCHAR}, #{dictTypeCode,jdbcType=VARCHAR}, #{userType,jdbcType=VARCHAR}, #{realName,jdbcType=VARCHAR}, 
      #{img,jdbcType=VARCHAR},#{wechatNickName,jdbcType=VARCHAR},#{openId,jdbcType=VARCHAR},#{unionId,jdbcType=VARCHAR}, #{nickName,jdbcType=VARCHAR}, 
      #{mobile,jdbcType=VARCHAR}, #{birthday,jdbcType=DATE}, #{provinceId,jdbcType=INTEGER}, 
      #{cityId,jdbcType=INTEGER}, #{districtId,jdbcType=INTEGER}, #{streetVillage,jdbcType=VARCHAR}, 
      #{buildingNo,jdbcType=VARCHAR}, #{sex,jdbcType=TINYINT}, #{userStatus,jdbcType=TINYINT}, 
      #{idCard,jdbcType=VARCHAR}, #{emergencyContactA,jdbcType=VARCHAR},#{relationWithA,jdbcType=VARCHAR},
       #{emergencyContactB,jdbcType=VARCHAR}, #{relationWithB,jdbcType=VARCHAR}
      #{userLevel,jdbcType=VARCHAR}, #{backInfo,jdbcType=VARCHAR}, #{remarks,jdbcType=VARCHAR}, 
      #{createTime,jdbcType=TIMESTAMP}, #{createBy,jdbcType=INTEGER}, #{updateTime,jdbcType=TIMESTAMP}, 
      #{updateBy,jdbcType=INTEGER})
  </insert>
  <update id="updateByPrimaryKey" parameterType="cn.com.dbridge.lifecare.dao.po.UserPO" >
   update t_user
    <set >
      <if test="userId != null" >
        USER_ID = #{userId,jdbcType=INTEGER},
      </if>
      <if test="userNumber != null" >
        USER_NUMBER = #{userNumber,jdbcType=VARCHAR},
      </if>
      <if test="password != null" >
        PASSWORD = #{password,jdbcType=VARCHAR},
      </if>
      <if test="dictTypeCode != null" >
        DICT_TYPE_CODE = #{dictTypeCode,jdbcType=VARCHAR},
      </if>
      <if test="userType != null" >
        USER_TYPE = #{userType,jdbcType=VARCHAR},
      </if>
      <if test="realName != null" >
        REAL_NAME = #{realName,jdbcType=VARCHAR},
      </if>
      <if test="img != null" >
        IMG = #{img,jdbcType=VARCHAR},
      </if>
       <if test="wechatNickName != null" >
        WECHAT_NICK_NAME = #{wechatNickName,jdbcType=VARCHAR},
      </if>
       <if test="openId != null" >
        OPEN_ID = #{openId,jdbcType=VARCHAR},
      </if>
       <if test="unionId != null" >
        UNION_ID = #{unionId,jdbcType=VARCHAR},
      </if>
      <if test="mobile != null" >
        MOBILE = #{mobile,jdbcType=VARCHAR},
      </if>
      <if test="email != null">
        EMAIL = #{email,jdbcType=VARCHAR},
      </if>
      <if test="birthday != null" >
        BIRTHDAY = #{birthday,jdbcType=DATE},
      </if>
      <if test="provinceId != null" >
        PROVINCE_ID = #{provinceId,jdbcType=INTEGER},
      </if>
      <if test="cityId != null" >
        CITY_ID = #{cityId,jdbcType=INTEGER},
      </if>
      <if test="districtId != null" >
        DISTRICT_ID = #{districtId,jdbcType=INTEGER},
      </if>
      <if test="streetVillage != null" >
        STREET_VILLAGE = #{streetVillage,jdbcType=VARCHAR},
      </if>
      <if test="buildingNo != null" >
        BUILDING_NO = #{buildingNo,jdbcType=VARCHAR},
      </if>
      <if test="sex != null" >
        SEX = #{sex,jdbcType=TINYINT},
      </if>
      <if test="userStatus != null" >
        USER_STATUS = #{userStatus,jdbcType=TINYINT},
      </if>
      <if test="idCard != null" >
        ID_CARD = #{idCard,jdbcType=VARCHAR},
      </if>
      <if test="emergencyContactA != null" >
        EMERGENCY_CONTACT_A = #{emergencyContactA,jdbcType=VARCHAR},
      </if>
      <if test="relationWithA != null" >
        RELATION_WITH_A = #{relationWithA,jdbcType=VARCHAR},
      </if>
      <if test="emergencyContactB != null" >
        EMERGENCY_CONTACT_B = #{emergencyContactB,jdbcType=VARCHAR},
      </if>
      <if test="relationWithB != null" >
        RELATION_WITH_B = #{relationWithB,jdbcType=VARCHAR},
      </if>
      <if test="userLevel != null" >
        USER_LEVEL = #{userLevel,jdbcType=VARCHAR},
      </if>
      <if test="backInfo != null" >
        BACK_INFO = #{backInfo,jdbcType=VARCHAR},
      </if>
      <if test="remarks != null" >
        REMARKS = #{remarks,jdbcType=VARCHAR},
      </if>
      <if test="remarks == null" >
        REMARKS = null,
      </if>
      <if test="createTime != null" >
        CREATE_TIME = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="createBy != null" >
        CREATE_BY = #{createBy,jdbcType=INTEGER},
      </if>
      <if test="updateTime != null" >
        UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateBy != null" >
        UPDATE_BY = #{updateBy,jdbcType=INTEGER},
      </if>
    </set>
    where USER_ID = #{userId,jdbcType=INTEGER}
  </update>
  
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    select 
	    USER_ID, 
	    USER_NUMBER, 
	    PASSWORD, 
	    DICT_TYPE_CODE,
	    USER_TYPE,
	    REAL_NAME, 
	    IMG, 
	    WECHAT_NICK_NAME,
	    OPEN_ID,
	    UNION_ID, 
	    MOBILE, 
	    EMAIL,
	    BIRTHDAY, 
	    PROVINCE_ID, 
	    CITY_ID, 
	    DISTRICT_ID, 
	    STREET_VILLAGE, 
	    STREET_VILLAGE_PINYIN,
	    BUILDING_NO, 
	    SEX, 
	    USER_STATUS, 
	    ID_CARD, 
	    EMERGENCY_CONTACT_A,
	    RELATION_WITH_A, 
	    EMERGENCY_CONTACT_B, 
	    RELATION_WITH_B,
	    USER_LEVEL, 
	    BACK_INFO, 
	    REMARKS, 
	    SERVICE_CATEGORY_LEVEL,
	    CREATE_TIME, 
	    CREATE_BY, 
	    UPDATE_TIME, 
	    UPDATE_BY,
	    DRAFT_NURSE_PLAN
    from 
        t_user
    where
        USER_ID = #{userId,jdbcType=INTEGER}
  </select>
  <select id="selectByUserNumber" resultMap="BaseResultMap" parameterType="java.lang.String" >
     select USER_ID, USER_NUMBER, PASSWORD, DICT_TYPE_CODE,USER_TYPE,REAL_NAME,IMG, WECHAT_NICK_NAME,OPEN_ID,UNION_ID, MOBILE, 
    BIRTHDAY, PROVINCE_ID, CITY_ID, DISTRICT_ID, STREET_VILLAGE, BUILDING_NO, SEX, USER_STATUS, 
    ID_CARD, EMERGENCY_CONTACT_A, RELATION_WITH_A,EMERGENCY_CONTACT_B,RELATION_WITH_B, USER_LEVEL
    from t_user
    where USER_NUMBER = #{userNumber,jdbcType=VARCHAR} and USER_TYPE!='1'
  </select>
  
  <select id="selectByUser" resultMap="BaseResultMap" parameterType="cn.com.dbridge.lifecare.dao.po.UserPO">
   select 
   		USER_ID, 
	    USER_NUMBER, 
	    PASSWORD, 
	    DICT_TYPE_CODE,
	    USER_TYPE,
	    REAL_NAME, 
	    IMG, 
	    WECHAT_NICK_NAME,
	    OPEN_ID,
	    UNION_ID, 
	    MOBILE, 
	    EMAIL,
	    BIRTHDAY, 
	    t_user.PROVINCE_ID, 
	    t_user.CITY_ID, 
	    t_user.DISTRICT_ID, 
	    STREET_VILLAGE, 
	    BUILDING_NO, 
	   	CONCAT(t_province.province_name,t_city.city_name,t_district.district_name,STREET_VILLAGE,BUILDING_NO) as USERADDR,
	    SEX, 
	    USER_STATUS, 
	    ID_CARD, 
	    EMERGENCY_CONTACT_A,
	    RELATION_WITH_A, 
	    EMERGENCY_CONTACT_B, 
	    RELATION_WITH_B,
	    USER_LEVEL, 
	    BACK_INFO, 
	    REMARKS, 
	    CREATE_TIME, 
	    CREATE_BY, 
	    UPDATE_TIME, 
	    UPDATE_BY,
	    DRAFT_NURSE_PLAN
    from t_user
    LEFT JOIN t_province ON t_user.PROVINCE_ID = t_province.PROVINCE_ID
		  LEFT JOIN t_city ON t_user.CITY_ID = t_city.city_id
		  LEFT JOIN t_district ON t_user.DISTRICT_ID = t_district.DISTRICT_ID
    <where>
		<if test="userId != null">
			AND USER_ID = #{userId,jdbcType=INTEGER}
		</if>
		<if test="userNumber != null">
			AND USER_NUMBER = #{userNumber,jdbcType=VARCHAR}
		</if>
		<if test="password != null">
			AND PASSWORD = #{password,jdbcType=VARCHAR}
		</if>
		<if test="dictTypeCode != null">
			AND DICT_TYPE_CODE = #{dictTypeCode,jdbcType=VARCHAR}
		</if>
		<if test="userType != null">
			AND USER_TYPE = #{userType,jdbcType=VARCHAR}
		</if>
		<if test="realName != null">
			AND REAL_NAME = #{realName,jdbcType=VARCHAR}
		</if>
		<if test="img != null">
			AND IMG = #{img,jdbcType=VARCHAR}
		</if>
		<if test="wechatNickName != null">
			AND WECHAT_NICK_NAME = #{wechatNickName,jdbcType=VARCHAR}
		</if>
		<if test="openId != null">
			AND OPEN_ID = #{openId,jdbcType=VARCHAR}
		</if>
		<if test="unionId != null">
			AND UNION_ID = #{unionId,jdbcType=VARCHAR}
		</if>
		<if test="mobile != null">
			AND MOBILE = #{mobile,jdbcType=VARCHAR}
		</if>
		<if test="birthday != null">
			AND BIRTHDAY = #{birthday,jdbcType=DATE}
		</if>
		<if test="provinceId != null">
			AND t_user.PROVINCE_ID = #{provinceId,jdbcType=INTEGER}
		</if>
		<if test="cityId != null">
			AND t_user.CITY_ID = #{cityId,jdbcType=INTEGER}
		</if>
		<if test="districtId != null">
			AND t_user.DISTRICT_ID = #{districtId,jdbcType=INTEGER}
		</if>
		<if test="streetVillage != null">
			AND STREET_VILLAGE = #{streetVillage,jdbcType=VARCHAR}
		</if>
		<if test="buildingNo != null">
			AND BUILDING_NO = #{buildingNo,jdbcType=VARCHAR}
		</if>
		<if test="sex != null">
			AND SEX = #{sex,jdbcType=TINYINT}
		</if>
		<if test="userStatus != null">
			AND USER_STATUS = #{userStatus,jdbcType=TINYINT}
		</if>
		<if test="idCard != null">
			AND ID_CARD = #{idCard,jdbcType=VARCHAR}
		</if>
		<if test="emergencyContactA != null">
			AND EMERGENCY_CONTACT_A = #{emergencyContactA,jdbcType=VARCHAR}
		</if>
		<if test="relationWithA != null">
			AND RELATION_WITH_A = #{relationWithA,jdbcType=VARCHAR}
		</if>
		<if test="emergencyContactB != null">
			AND EMERGENCY_CONTACT_B = #{emergencyContactB,jdbcType=VARCHAR}
		</if>
		<if test="relationWithB != null">
			AND EMERGENCY_CONTACT_B = #{relationWithB,jdbcType=VARCHAR}
		</if>
		<if test="userLevel != null">
			AND USER_LEVEL = #{userLevel,jdbcType=VARCHAR}
		</if>
		<if test="backInfo != null">
			AND BACK_INFO = #{backInfo,jdbcType=VARCHAR}
		</if>
		<if test="remarks != null">
			AND REMARKS = #{remarks,jdbcType=VARCHAR}
		</if>
		<if test="createTime != null">
			AND CREATE_TIME = #{createTime,jdbcType=TIMESTAMP}
		</if>
		<if test="createBy != null">
			AND CREATE_BY = #{createBy,jdbcType=INTEGER}
		</if>
		<if test="updateTime != null">
			AND UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP}
		</if>
		<if test="updateBy != null">
			AND UPDATE_BY = #{updateBy,jdbcType=INTEGER}
		</if>
	</where>
  </select>


    <select id="selectUserListByUser" resultMap="BaseResultMap" parameterType="cn.com.dbridge.lifecare.dao.po.UserPO">
        select
        USER_ID,
        USER_NUMBER,
        PASSWORD,
        DICT_TYPE_CODE,
        USER_TYPE,
        REAL_NAME,
        IMG,
        WECHAT_NICK_NAME,
        OPEN_ID,
        UNION_ID,
        MOBILE,
        EMAIL,
        BIRTHDAY,
        t_user.PROVINCE_ID,
        t_user.CITY_ID,
        t_user.DISTRICT_ID,
        STREET_VILLAGE,
        BUILDING_NO,
        CONCAT(t_province.province_name,t_city.city_name,t_district.district_name,STREET_VILLAGE,BUILDING_NO) as USERADDR,
        SEX,
        USER_STATUS,
        ID_CARD,
        EMERGENCY_CONTACT_A,
        RELATION_WITH_A,
        EMERGENCY_CONTACT_B,
        RELATION_WITH_B,
        USER_LEVEL,
        BACK_INFO,
        REMARKS,
        CREATE_TIME,
        CREATE_BY,
        UPDATE_TIME,
        UPDATE_BY,
        DRAFT_NURSE_PLAN
        from t_user
        LEFT JOIN t_province ON t_user.PROVINCE_ID = t_province.PROVINCE_ID
        LEFT JOIN t_city ON t_user.CITY_ID = t_city.city_id
        LEFT JOIN t_district ON t_user.DISTRICT_ID = t_district.DISTRICT_ID
        <where>
            <if test="userId != null">
                AND USER_ID = #{userId,jdbcType=INTEGER}
            </if>
            <if test="userNumber != null">
                AND USER_NUMBER = #{userNumber,jdbcType=VARCHAR}
            </if>
            <if test="password != null">
                AND PASSWORD = #{password,jdbcType=VARCHAR}
            </if>
            <if test="dictTypeCode != null">
                AND DICT_TYPE_CODE = #{dictTypeCode,jdbcType=VARCHAR}
            </if>
            <if test="userType != null">
                AND USER_TYPE = #{userType,jdbcType=VARCHAR}
            </if>
            <if test="realName != null">
                AND REAL_NAME = #{realName,jdbcType=VARCHAR}
            </if>
            <if test="img != null">
                AND IMG = #{img,jdbcType=VARCHAR}
            </if>
            <if test="wechatNickName != null">
                AND WECHAT_NICK_NAME = #{wechatNickName,jdbcType=VARCHAR}
            </if>
            <if test="openId != null">
                AND OPEN_ID = #{openId,jdbcType=VARCHAR}
            </if>
            <if test="unionId != null">
                AND UNION_ID = #{unionId,jdbcType=VARCHAR}
            </if>
            <if test="mobile != null">
                AND MOBILE = #{mobile,jdbcType=VARCHAR}
            </if>
            <if test="birthday != null">
                AND BIRTHDAY = #{birthday,jdbcType=DATE}
            </if>
            <if test="provinceId != null">
                AND PROVINCE_ID = #{provinceId,jdbcType=INTEGER}
            </if>
            <if test="cityId != null">
                AND CITY_ID = #{cityId,jdbcType=INTEGER}
            </if>
            <if test="districtId != null">
                AND DISTRICT_ID = #{districtId,jdbcType=INTEGER}
            </if>
            <if test="streetVillage != null">
                AND STREET_VILLAGE = #{streetVillage,jdbcType=VARCHAR}
            </if>
            <if test="buildingNo != null">
                AND BUILDING_NO = #{buildingNo,jdbcType=VARCHAR}
            </if>
            <if test="sex != null">
                AND SEX = #{sex,jdbcType=TINYINT}
            </if>
            <if test="userStatus != null">
                AND USER_STATUS = #{userStatus,jdbcType=TINYINT}
            </if>
            <if test="idCard != null">
                AND ID_CARD = #{idCard,jdbcType=VARCHAR}
            </if>
            <if test="emergencyContactA != null">
                AND EMERGENCY_CONTACT_A = #{emergencyContactA,jdbcType=VARCHAR}
            </if>
            <if test="relationWithA != null">
                AND RELATION_WITH_A = #{relationWithA,jdbcType=VARCHAR}
            </if>
            <if test="emergencyContactB != null">
                AND EMERGENCY_CONTACT_B = #{emergencyContactB,jdbcType=VARCHAR}
            </if>
            <if test="relationWithB != null">
                AND EMERGENCY_CONTACT_B = #{relationWithB,jdbcType=VARCHAR}
            </if>
            <if test="userLevel != null">
                AND USER_LEVEL = #{userLevel,jdbcType=VARCHAR}
            </if>
            <if test="backInfo != null">
                AND BACK_INFO = #{backInfo,jdbcType=VARCHAR}
            </if>
            <if test="remarks != null">
                AND REMARKS = #{remarks,jdbcType=VARCHAR}
            </if>
            <if test="createTime != null">
                AND CREATE_TIME = #{createTime,jdbcType=TIMESTAMP}
            </if>
            <if test="createBy != null">
                AND CREATE_BY = #{createBy,jdbcType=INTEGER}
            </if>
            <if test="updateTime != null">
                AND UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP}
            </if>
            <if test="updateBy != null">
                AND UPDATE_BY = #{updateBy,jdbcType=INTEGER}
            </if>
        </where>
    </select>
  
  
  
  <select id="selectAll" resultMap="BaseResultMap" >
    select USER_ID, USER_NUMBER, PASSWORD,DICT_TYPE_CODE, USER_TYPE,REAL_NAME,IMG, WECHAT_NICK_NAME,OPEN_ID,UNION_ID, MOBILE, 
    BIRTHDAY, PROVINCE_ID, CITY_ID, DISTRICT_ID, STREET_VILLAGE, BUILDING_NO, SEX, USER_STATUS, 
    ID_CARD, EMERGENCY_CONTACT_A, RELATION_WITH_A,EMERGENCY_CONTACT_B, RELATION_WITH_B,USER_LEVEL, BACK_INFO, REMARKS, 
    CREATE_TIME, CREATE_BY, UPDATE_TIME, UPDATE_BY
    from t_user
  </select>
  
  <!-- 用于获取我的信息页信息 -->
  <select id="selectMyInfo" parameterType="cn.com.dbridge.lifecare.dao.po.UserPO" resultMap="MyInfoResultMap">
    select 
        u.USER_ID,
        u.IMG,
        u.REAL_NAME,
        u.ID_CARD,
        u.USER_NUMBER,
        u.USER_TYPE,
        u.BIRTHDAY,
        u.MOBILE,
        u.PROVINCE_ID,
        p.PROVINCE_NAME,
        u.CITY_ID,
        c.CITY_NAME,
        u.DISTRICT_ID,
        d.DISTRICT_NAME,
        u.STREET_VILLAGE,
        u.BUILDING_NO,
        u.EMAIL,
        u.WECHAT_NICK_NAME,
        u.OPEN_ID
    from 
        t_user u 
    left join 
        t_province p on u.PROVINCE_ID = p.PROVINCE_ID
    left join 
        t_city c on u.CITY_ID = c.CITY_ID
    left join 
        t_district d on u.DISTRICT_ID = d.DISTRICT_ID
    where 
        USER_ID = #{userId,jdbcType=INTEGER}
    <if test="userType != null">
        AND USER_TYPE = #{userType,jdbcType=INTEGER}
    </if>
  </select>

    <select id="getAllImgs" resultType="string">
        SELECT DISTINCT img FROM t_user WHERE img IS NOT NULL
    </select>
</mapper>