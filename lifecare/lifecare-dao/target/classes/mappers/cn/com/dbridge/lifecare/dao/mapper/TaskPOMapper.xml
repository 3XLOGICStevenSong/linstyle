<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.com.dbridge.lifecare.dao.respository.TaskPOMapper" >
  <resultMap id="BaseResultMap" type="cn.com.dbridge.lifecare.dao.po.TaskPO" >
    <result column="ID" property="id" jdbcType="INTEGER" />
    <result column="ORDER_NO" property="orderNo" jdbcType="VARCHAR" />
    <result column="CUSTOM_ID" property="customId" jdbcType="INTEGER" />
    <result column="SERVICE_PERSON_ID" property="servicePersonId" jdbcType="INTEGER" />
    <result column="DICT_TYPE_CODE" property="dictTypeCode" jdbcType="VARCHAR" />
    <result column="SERVICE_CATEGORY_CODE" property="serviceCategoryCode" jdbcType="VARCHAR" />
    <result column="SEX_REQUIRE" property="sexRequire" jdbcType="TINYINT" />
    <result column="ORDER_ADDR" property="orderAddr" jdbcType="VARCHAR" />
    <result column="ORDER_DATE" property="orderDate" jdbcType="DATE" />
    <result column="ORDER_DURATION" property="orderDuration" jdbcType="INTEGER" />
    <result column="ORDER_BEGIN_TIME" property="orderBeginTime" jdbcType="TIME" />
    <result column="ORDER_END_TIME" property="orderEndTime" jdbcType="TIME" />
    <result column="CONTENT" property="content" jdbcType="VARCHAR" />
    <result column="REMARK" property="remark" jdbcType="VARCHAR" />
    <result column="SERVICE_BEGIN_TIME" property="serviceBeginTime" jdbcType="TIME" />
    <result column="SERVICE_END_TIME" property="serviceEndTime" jdbcType="TIME" />
    <result column="SERVICE_DURATION" property="serviceDuration" jdbcType="INTEGER" />
    <result column="SERVICE_DESC" property="serviceDesc" jdbcType="VARCHAR" />
    <result column="ORDER_STATUS" property="orderStatus" jdbcType="TINYINT" />
    <result column="CANCEL_RESON" property="cancelReson" jdbcType="VARCHAR" />
    <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
    <result column="CREATE_BY" property="createBy" jdbcType="INTEGER" />
    <result column="UPDATE_TIME" property="updateTime" jdbcType="TIMESTAMP" />
    <result column="UPDATE_BY" property="updateBy" jdbcType="INTEGER" />
  </resultMap>
  <resultMap id="UnassignedTaskManageResultMap" type="cn.com.dbridge.lifecare.dao.po.UnassignedTaskResultPO" >
    <result column="ID" property="id" jdbcType="INTEGER" />
    <result column="ORDER_NO" property="orderNo" jdbcType="VARCHAR" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="ORDER_DATE" property="orderDate" jdbcType="DATE" />
    <result column="ORDER_STATUS" property="orderStatus" jdbcType="TINYINT" />
    <result column="ORDER_BEGIN_TIME" property="orderBeginTime" jdbcType="TIME" />
    <result column="ORDER_DURATION" property="orderDuration" jdbcType="INTEGER" />
    <result column="USER_ID" property="customId" jdbcType="INTEGER" />
    <result column="REAL_NAME" property="realName" jdbcType="VARCHAR" />
    <result column="MOBILE" property="mobile" jdbcType="VARCHAR" />
  </resultMap>
  <!--<resultMap id="ServicePersonResultMap" type="cn.com.dbridge.lifecare.dao.po.WebUnassignedTaskSeePO">
    <result column="ORDER_DURATION" property="orderDuration" jdbcType="INTEGER" />
    <result column="ORDER_NO" property="orderNo" jdbcType="VARCHAR" />
    <result column="SERVICE_PERSON_ID" property="servicePersonId" jdbcType="INTEGER" />
    <result column="USER_NUMBER" property="userNumber" jdbcType="VARCHAR" />
    <result column="REAL_NAME" property="realName" jdbcType="VARCHAR" />
    <result column="MOBILE" property="mobile" jdbcType="VARCHAR" />
    <result column="DISTRICT_NAME" property="districtName" jdbcType="VARCHAR" />
    <result column="STREET_VILLAGE" property="streetVillage" jdbcType="VARCHAR" />
    <result column="BUILDING_NO" property="buildingNo" jdbcType="VARCHAR" />
    <result column="BIRTHDAY" property="birthday" jdbcType="DATE" />
    <result column="SEX" property="sex" jdbcType="TINYINT" />
    <result column="USER_LEVEL" property="userLevel" jdbcType="VARCHAR" />
    <result column="USER_STATUS" property="userStatus" jdbcType="TINYINT" />
  </resultMap>-->
  <resultMap id="TaskPoolResultMap" type="cn.com.dbridge.lifecare.dao.po.TaskPoolResultPO">
      <result column="description" property="description" jdbcType="VARCHAR" />    
      <result column="CUSTOM_ID" property="customId" jdbcType="INTEGER" />
      <result column="ORDER_ADDR" property="orderAddr" jdbcType="VARCHAR" />
      <result column="ORDER_DATE" property="orderDate" jdbcType="DATE" />
      <result column="ORDER_BEGIN_TIME" property="orderBeginTime" jdbcType="TIME" />
      <result column="ORDER_END_TIME" property="orderEndTime" jdbcType="TIME" />
      <result column="BIRTHDAY" property="birthday" jdbcType="DATE" />
      <result column="SEX" property="sex" jdbcType="TINYINT" />
      <result column="ID" property="id" jdbcType="INTEGER" />
      <result column="ORDER_NO" property="orderNo" jdbcType="VARCHAR" />
      <result column="SEX_REQUIRE" property="sexRequire" jdbcType="TINYINT" />
      <result column="SERVICE_CATEGORY_CODE" property="serviceCategoryCode" jdbcType="VARCHAR" />
  </resultMap>
  <resultMap id="TaskResultMap" type="cn.com.dbridge.lifecare.dao.po.TaskManageResPO">
       <result column="ID" property="id" jdbcType="INTEGER" />
       <result column="ORDER_NO" property="orderNo" jdbcType="VARCHAR" />
       <result column="name" property="serviceCategoryName" jdbcType="VARCHAR" />
       <result column="ORDER_DATE" property="orderDate" jdbcType="DATE" />
       <result column="ORDER_STATUS" property="orderStatus" jdbcType="TINYINT" />
       <result column="ORDER_BEGIN_TIME" property="orderBeginTime" jdbcType="TIME" />
       <result column="ORDER_DURATION" property="orderDuration" jdbcType="INTEGER" />
       <result column="SERVICE_DURATION" property="serviceDuration" jdbcType="INTEGER" />
       <result column="CUSTOM_ID" property="customId" jdbcType="INTEGER" />
       <result column="REAL_NAME" property="customRealName" jdbcType="VARCHAR" />
       <result column="SERVICE_PERSON_ID" property="servicePersonId" jdbcType="INTEGER" />
       <result column="SERVICE_PERSON_REAL_NAME" property="servicePersonRealName" jdbcType="VARCHAR" />
        <result column="SERVICE_BEGIN_TIME" property="serviceBeginTime" jdbcType="TIME" />
  </resultMap>
  
  <!-- 插入 -->
  <insert id="insert" parameterType="cn.com.dbridge.lifecare.dao.po.TaskPO" >
    <selectKey resultType="java.lang.Integer" keyProperty="id" order="AFTER" >
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into 
    t_task (ORDER_NO, 
            CUSTOM_ID, 
            SERVICE_PERSON_ID, 
            DICT_TYPE_CODE,
            SERVICE_CATEGORY_CODE, 
            SEX_REQUIRE, 
            ORDER_ADDR, 
            ORDER_DATE,
            ORDER_DURATION,
            ORDER_BEGIN_TIME, 
            ORDER_END_TIME, 
            CONTENT, 
            REMARK, 
            SERVICE_BEGIN_TIME, 
            SERVICE_END_TIME, 
            SERVICE_DURATION, 
            SERVICE_DESC, 
            ORDER_STATUS, 
            CANCEL_RESON, 
            CREATE_TIME, 
            CREATE_BY, 
            UPDATE_TIME, 
            UPDATE_BY
    )
    values (#{orderNo,jdbcType=VARCHAR},
          #{customId,jdbcType=INTEGER},
          #{servicePersonId,jdbcType=INTEGER},
          #{dictTypeCode,jdbcType=VARCHAR}, 
          #{serviceCategoryCode,jdbcType=VARCHAR},
          #{sexRequire,jdbcType=TINYINT},
          #{orderAddr,jdbcType=VARCHAR}, 
          #{orderDate,jdbcType=DATE},
          #{orderDuration,jdbcType=VARCHAR},
          #{orderBeginTime,jdbcType=TIME},
          #{orderEndTime,jdbcType=TIME}, 
          #{content,jdbcType=VARCHAR},
          #{remark,jdbcType=VARCHAR},
          #{serviceBeginTime,jdbcType=TIME}, 
          #{serviceEndTime,jdbcType=TIME},
          #{serviceDuration,jdbcType=VARCHAR},
          #{serviceDesc,jdbcType=VARCHAR}, 
          #{orderStatus,jdbcType=TINYINT}, 
          #{cancelReson,jdbcType=VARCHAR},
          #{createTime,jdbcType=TIMESTAMP}, 
          #{createBy,jdbcType=INTEGER},
          #{updateTime,jdbcType=TIMESTAMP},
          #{updateBy,jdbcType=INTEGER}
    )
  </insert>
  
  <!-- 获取全部 -->
  <select id="selectAll" resultMap="BaseResultMap" >
    select 
        ID, 
        ORDER_NO, 
        CUSTOM_ID,
        SERVICE_PERSON_ID, 
        DICT_TYPE_CODE,
        SERVICE_CATEGORY_CODE, 
        SEX_REQUIRE, 
        ORDER_ADDR, 
        ORDER_DATE, 
        ORDER_BEGIN_TIME, 
        ORDER_END_TIME, 
        CONTENT, REMARK, 
        SERVICE_BEGIN_TIME, 
        SERVICE_END_TIME, 
        SERVICE_DURATION, 
        SERVICE_DESC, 
        ORDER_STATUS, 
        CANCEL_RESON, 
        CREATE_TIME, 
        CREATE_BY, 
        UPDATE_TIME, 
        UPDATE_BY
    from t_task
  </select>
  
  <!-- 根据主键获取任务 -->
  <select id="selectTaskByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer">
    select 
        ID, 
        ORDER_NO, 
        CUSTOM_ID, 
        SERVICE_PERSON_ID,
        DICT_TYPE_CODE, 
        SERVICE_CATEGORY_CODE, 
        SEX_REQUIRE, 
        ORDER_ADDR, 
        ORDER_DATE, 
        ORDER_BEGIN_TIME, 
        ORDER_END_TIME, 
        CONTENT, 
        REMARK, 
        SERVICE_BEGIN_TIME, 
        SERVICE_END_TIME, 
        SERVICE_DURATION, 
        SERVICE_DESC, 
        ORDER_STATUS, 
        CANCEL_RESON, 
        CREATE_TIME, 
        CREATE_BY, 
        UPDATE_TIME, 
        UPDATE_BY
    from t_task
    where ID = #{id,jdbcType=INTEGER} 
    </select>
  
  <!-- 获取任务 -->
  <select id="selectTask" resultMap="BaseResultMap" parameterType="cn.com.dbridge.lifecare.dao.po.TaskPO">
    select 
        ID, 
        ORDER_NO, 
        CUSTOM_ID, 
        SERVICE_PERSON_ID,
        DICT_TYPE_CODE, 
        SERVICE_CATEGORY_CODE, 
        SEX_REQUIRE, 
        ORDER_ADDR, 
        ORDER_DATE, 
        ORDER_BEGIN_TIME, 
        ORDER_END_TIME, 
        CONTENT, 
        REMARK, 
        SERVICE_BEGIN_TIME, 
        SERVICE_END_TIME, 
        SERVICE_DURATION, 
        SERVICE_DESC, 
        ORDER_STATUS, 
        CANCEL_RESON, 
        CREATE_TIME, 
        CREATE_BY, 
        UPDATE_TIME, 
        UPDATE_BY
    from t_task
    <where>
      <if test="id != null and id != ''" >
        ID = #{id,jdbcType=INTEGER}
      </if>
      <if test="orderNo != null and orderNo != ''" >
        and ORDER_NO = #{orderNo,jdbcType=VARCHAR}
      </if>
      <if test="customId != null and customId != ''" >
        and CUSTOM_ID = #{customId,jdbcType=INTEGER}
      </if>
      <if test="servicePersonId != null and servicePersonId != ''" >
        and SERVICE_PERSON_ID = #{servicePersonId,jdbcType=INTEGER}
      </if>
      <if test="dictTypeCode != null and dictTypeCode != ''" >
        and DICT_TYPE_CODE = #{dictTypeCode,jdbcType=INTEGER}
      </if>
      <if test="serviceCategoryCode != null and serviceCategoryCode != ''" >
        and SERVICE_CATEGORY_CODE = #{serviceCategoryCode,jdbcType=VARCHAR}
      </if>
      <if test="sexRequire != null and sexRequire != ''" >
        and SEX_REQUIRE = #{sexRequire,jdbcType=TINYINT}
      </if>
      <if test="orderAddr != null and orderAddr != ''" >
        and ORDER_ADDR = #{orderAddr,jdbcType=VARCHAR}
      </if>
      <if test="orderDate != null" >
        and ORDER_DATE = #{orderDate,jdbcType=DATE}
      </if>
      <if test="orderBeginTime != null and orderBeginTime != ''" >
        and ORDER_BEGIN_TIME = #{orderBeginTime,jdbcType=TIME}
      </if>
      <if test="orderEndTime != null and orderEndTime != ''" >
        and ORDER_END_TIME = #{orderEndTime,jdbcType=TIME}
      </if>
      <if test="content != null and content != ''" >
        and CONTENT = #{content,jdbcType=VARCHAR}
      </if>
      <if test="remark != null and remark != ''" >
        and REMARK = #{remark,jdbcType=VARCHAR}
      </if>
      <if test="serviceBeginTime != null and serviceBeginTime != ''" >
        and SERVICE_BEGIN_TIME = #{serviceBeginTime,jdbcType=TIME}
      </if>
      <if test="serviceEndTime != null and serviceEndTime != ''" >
        and SERVICE_END_TIME = #{serviceEndTime,jdbcType=TIME}
      </if>
      <if test="serviceDuration != null and serviceDuration != ''" >
        and SERVICE_DURATION = #{serviceDuration,jdbcType=VARCHAR}
      </if>
      <if test="serviceDesc != null and serviceDesc != ''" >
        and SERVICE_DESC = #{serviceDesc,jdbcType=VARCHAR}
      </if>
      <if test="orderStatus != null and orderStatus != ''" >
        and ORDER_STATUS = #{orderStatus,jdbcType=TINYINT}
      </if>
      <if test="cancelReson != null and cancelReson != ''" >
        and CANCEL_RESON = #{cancelReson,jdbcType=VARCHAR}
      </if>
      <if test="createTime != null and createTime != ''" >
        and CREATE_TIME = #{createTime,jdbcType=TIMESTAMP}
      </if>
      <if test="createBy != null and createBy != ''" >
        and CREATE_BY = #{createBy,jdbcType=INTEGER}
      </if>
      <if test="updateTime != null and updateTime != ''" >
        and UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP}
      </if>
      <if test="updateBy != null and updateBy != ''" >
        and UPDATE_BY = #{updateBy,jdbcType=INTEGER}
      </if>
    </where>
  </select>
  
  <!--  -->
  <select id="selectTaskCust" resultMap="BaseResultMap" parameterType="cn.com.dbridge.lifecare.dao.po.TaskPO">
    select 
        ID, 
        ORDER_NO, 
        CUSTOM_ID, 
        SERVICE_PERSON_ID,
        DICT_TYPE_CODE, 
        SERVICE_CATEGORY_CODE, 
        SEX_REQUIRE, 
        ORDER_ADDR, 
        ORDER_DATE, 
        ORDER_BEGIN_TIME, 
        ORDER_END_TIME, 
        CONTENT, 
        REMARK, 
        SERVICE_BEGIN_TIME, 
        SERVICE_END_TIME, 
        SERVICE_DURATION, 
        SERVICE_DESC, 
        ORDER_STATUS, 
        CANCEL_RESON, 
        CREATE_TIME, 
        CREATE_BY, 
        UPDATE_TIME, 
        UPDATE_BY
    from t_task
    <where>
      <if test="id != null and id != ''" >
        ID = #{id,jdbcType=INTEGER}
      </if>
      <if test="orderNo != null and orderNo != ''" >
        and ORDER_NO = #{orderNo,jdbcType=VARCHAR}
      </if>
      <if test="customId != null and customId != ''" >
        and CUSTOM_ID = #{customId,jdbcType=INTEGER}
      </if>
      <if test="servicePersonId != null and servicePersonId != ''" >
        and SERVICE_PERSON_ID = #{servicePersonId,jdbcType=INTEGER}
      </if>
      <if test="dictTypeCode != null and dictTypeCode != ''" >
        and DICT_TYPE_CODE = #{dictTypeCode,jdbcType=INTEGER}
      </if>
      <if test="serviceCategoryCode != null and serviceCategoryCode != ''" >
        and SERVICE_CATEGORY_CODE = #{serviceCategoryCode,jdbcType=VARCHAR}
      </if>
      <if test="sexRequire != null and sexRequire != ''" >
        and SEX_REQUIRE = #{sexRequire,jdbcType=TINYINT}
      </if>
      <if test="orderAddr != null and orderAddr != ''" >
        and ORDER_ADDR = #{orderAddr,jdbcType=VARCHAR}
      </if>
      <if test="orderDate != null" >
        and ORDER_DATE = #{orderDate,jdbcType=DATE}
      </if>
      <if test="orderBeginTime != null" >
        and ORDER_BEGIN_TIME = #{orderBeginTime,jdbcType=TIME}
      </if>
      <if test="orderEndTime != null" >
        and ORDER_END_TIME = #{orderEndTime,jdbcType=TIME}
      </if>
      <if test="content != null and content != ''" >
        and CONTENT = #{content,jdbcType=VARCHAR}
      </if>
      <if test="remark != null and remark != ''" >
        and REMARK = #{remark,jdbcType=VARCHAR}
      </if>
      <if test="serviceBeginTime != null">
        and SERVICE_BEGIN_TIME &gt; #{serviceBeginTime,jdbcType=TIME} or SERVICE_END_TIME &lt; #{serviceEndTime,jdbcType=TIME}
      </if>
      <if test="serviceDuration != null and serviceDuration != ''" >
        and SERVICE_DURATION = #{serviceDuration,jdbcType=VARCHAR}
      </if>
      <if test="serviceDesc != null and serviceDesc != ''" >
        and SERVICE_DESC = #{serviceDesc,jdbcType=VARCHAR}
      </if>
      <if test="orderStatus != null and orderStatus != ''" >
        and ORDER_STATUS = #{orderStatus,jdbcType=TINYINT}
      </if>
      <if test="cancelReson != null and cancelReson != ''" >
        and CANCEL_RESON = #{cancelReson,jdbcType=VARCHAR}
      </if>
      <if test="createTime != null" >
        and CREATE_TIME = #{createTime,jdbcType=TIMESTAMP}
      </if>
      <if test="createBy != null and createBy != ''" >
        and CREATE_BY = #{createBy,jdbcType=INTEGER}
      </if>
      <if test="updateTime != null" >
        and UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP}
      </if>
      <if test="updateBy != null and updateBy != ''" >
        and UPDATE_BY = #{updateBy,jdbcType=INTEGER}
      </if>
    </where>
  </select>
  
  <!-- 获取待处理订单数(异常任务) -->
  <select id="selectPendingCount" resultType="java.lang.Integer" >
    SELECT 
      COUNT(ID)
    FROM
      t_task
    WHERE
      (  (
            ISNULL(SERVICE_BEGIN_TIME) AND 
             (NOW() > 
                  DATE_ADD(
                    CONCAT(DATE_FORMAT(ORDER_DATE, '%Y-%m-%d '), 
                           DATE_FORMAT(ORDER_BEGIN_TIME, '%T')),
                           INTERVAL 10 MINUTE 
                  )
              )
          )
          OR 
          (
             (NOT ISNULL(SERVICE_BEGIN_TIME)) AND 
              ISNULL(SERVICE_END_TIME) AND 
              (NOW() > 
                  DATE_ADD(
                    CONCAT(DATE_FORMAT(ORDER_DATE, '%Y-%m-%d '), 
                           DATE_FORMAT(ORDER_END_TIME, '%T')),
                           INTERVAL 10 MINUTE 
                  )
              )
         )
      ) 
      AND
      (
          ORDER_STATUS = 1 OR ORDER_STATUS = 2 OR ORDER_STATUS = 5
      )
  </select>
  
  <!-- 获取我的任务页面有预约任务的日期 -->
  <select id="SelectCalendarListForMyTask">
    select
        t.ORDER_DATE
    from
        t_task t
    where
        DATE_FORMAT(t.ORDER_DATE,'%Y%m') = #{orderDate,jdbcType=DATE}
    group by
        t.ORDER_DATE
  </select>
  
  <!-- 获取未分配任务管理页信息 -->
  <select id="selectUnassignedTaskManage" parameterType="cn.com.dbridge.lifecare.dao.po.UnassignedTaskPO" resultMap="UnassignedTaskManageResultMap">
    select 
        t.ID,
        t.ORDER_NO, 
		d.name,
		t.ORDER_DATE,
		t.ORDER_BEGIN_TIME,
		t.ORDER_STATUS,
        t.ORDER_DURATION, 
        u.USER_ID,
        u.REAL_NAME, 
        u.MOBILE
    from 
        t_task t 
		left join t_user u on t.CUSTOM_ID = u.USER_ID 
        left join t_dict d on t.SERVICE_CATEGORY_CODE = d.code and t.DICT_TYPE_CODE = d.type
     <where>
        <if test="serviceCategoryCodes != null and serviceCategoryCodes.size > 0">
           <foreach collection="serviceCategoryCodes" item="serviceCategoryCode" open="and (" close=")" separator="or">
             t.SERVICE_CATEGORY_CODE = #{serviceCategoryCode,jdbcType=VARCHAR}
           </foreach>
        </if>
        <if test="serviceCategoryCodes.isEmpty()">
          t.SERVICE_CATEGORY_CODE = null
        </if>
        <if test="orderNo != null and orderNo != ''">
          and t.ORDER_NO like CONCAT(CONCAT('%',#{orderNo,jdbcType=VARCHAR}),'%') 
        </if>
        <if test="userNumber != null and userNumber != ''">
          and u.USER_NUMBER like CONCAT(CONCAT('%',#{userNumber,jdbcType=INTEGER}),'%') 
        </if>
        <if test="orderDateFrom != null">
          and date_format(t.ORDER_DATE,'%Y-%m-%d') &gt;= date_format(#{orderDateFrom,jdbcType=DATE},'%Y-%m-%d')
        </if>
        <if test="orderDateTo != null">
          and date_format(t.ORDER_DATE,'%Y-%m-%d') &lt;= date_format(#{orderDateTo,jdbcType=DATE},'%Y-%m-%d')
        </if>
        <if test="realName != null and realName != ''">
          and u.REAL_NAME = #{realName,jdbcType=VARCHAR}
        </if>
        <if test="orderBeginTimeFrom != null">
          and date_format(t.ORDER_BEGIN_TIME,'%T') &gt;= #{orderBeginTimeFrom,jdbcType=TIME}
        </if>
        <if test="orderBeginTimeTo != null">
          and date_format(t.ORDER_BEGIN_TIME,'%T') &lt;= #{orderBeginTimeTo,jdbcType=TIME}
        </if>
        <if test="birthday != null">
          and u.BIRTHDAY = #{birthday,jdbcType=DATE}
        </if>
        <if test="orderDurationFrom != null and orderDurationFrom != ''">
          and t.ORDER_DURATION &gt;= #{orderDurationFrom,jdbcType=VARCHAR}
        </if>
        <if test="orderDurationTo != null and orderDurationTo != ''">
          and t.ORDER_DURATION &lt;= #{orderDurationTo,jdbcType=VARCHAR}
        </if>
        <if test="mobile != null and mobile != ''">
          and u.MOBILE = #{mobile,jdbcType=VARCHAR}
        </if>
        <if test="idCard != null and idCard != ''">
          and u.ID_CARD = #{idCard,jdbcType=VARCHAR}
        </if>
        and t.DICT_TYPE_CODE = 'SERVER_TYPE'
        and t.ORDER_STATUS = 1
    </where>
    order by t.ORDER_NO asc
  </select> 
  
  <!-- 获取未分配任务预约总时长 -->
  <select id="selectUnassignedTaskTotalOrderDuration" parameterType="cn.com.dbridge.lifecare.dao.po.UnassignedTaskPO" resultType="java.lang.Integer">
  	select
        sum(t.ORDER_DURATION)
    from 
    	t_task t 
		left join t_user u on t.CUSTOM_ID = u.USER_ID 
        left join t_dict d on t.SERVICE_CATEGORY_CODE = d.code and t.DICT_TYPE_CODE = d.type
     <where>
       <if test="serviceCategoryCodes != null and serviceCategoryCodes.size > 0">
           <foreach collection="serviceCategoryCodes" item="serviceCategoryCode" open="and (" close=")" separator="or">
             t.SERVICE_CATEGORY_CODE = #{serviceCategoryCode,jdbcType=VARCHAR}
           </foreach>
        </if>
        <if test="serviceCategoryCodes.isEmpty()">
          t.SERVICE_CATEGORY_CODE = null
        </if>
        <if test="orderNo != null and orderNo != ''">
          and t.ORDER_NO like CONCAT(CONCAT('%',#{orderNo,jdbcType=VARCHAR}),'%') 
        </if>
        <if test="userNumber != null and userNumber != ''">
          and u.USER_NUMBER like CONCAT(CONCAT('%',#{userNumber,jdbcType=INTEGER}),'%') 
        </if>
        <if test="orderDateFrom != null">
          and date_format(t.ORDER_DATE,'%Y-%m-%d') &gt;= date_format(#{orderDateFrom,jdbcType=DATE},'%Y-%m-%d')
        </if>
        <if test="orderDateTo != null">
          and date_format(t.ORDER_DATE,'%Y-%m-%d') &lt;= date_format(#{orderDateTo,jdbcType=DATE},'%Y-%m-%d')
        </if>
        <if test="realName != null and realName != ''">
          and u.REAL_NAME = #{realName,jdbcType=VARCHAR}
        </if>
        <if test="orderBeginTimeFrom != null">
          and date_format(t.ORDER_BEGIN_TIME,'%T') &gt;= #{orderBeginTimeFrom,jdbcType=TIME}
        </if>
        <if test="orderBeginTimeTo != null">
          and date_format(t.ORDER_BEGIN_TIME,'%T') &lt;= #{orderBeginTimeTo,jdbcType=TIME}
        </if>
        <if test="birthday != null">
          and u.BIRTHDAY = #{birthday,jdbcType=DATE}
        </if>
        <if test="orderDurationFrom != null and orderDurationFrom != ''">
          and t.ORDER_DURATION &gt;= #{orderDurationFrom,jdbcType=VARCHAR}
        </if>
        <if test="orderDurationTo != null and orderDurationTo != ''">
          and t.ORDER_DURATION &lt;= #{orderDurationTo,jdbcType=VARCHAR}
        </if>
        <if test="mobile != null and mobile != ''">
          and u.MOBILE = #{mobile,jdbcType=VARCHAR}
        </if>
        <if test="idCard != null and idCard != ''">
          and u.ID_CARD = #{idCard,jdbcType=VARCHAR}
        </if>
        and t.DICT_TYPE_CODE = 'SERVER_TYPE'
        and t.ORDER_STATUS = 1
    </where>
  </select>
  
  <!-- 获取任务管理页信息 -->
  <select id="selectTaskManage" parameterType="cn.com.dbridge.lifecare.dao.po.TaskManagePO" resultMap="TaskResultMap"> 
    select
        t.ID,
        t.ORDER_NO,
        d.name,
        t.ORDER_DATE,
        t.ORDER_BEGIN_TIME,
        t.ORDER_DURATION,
        t.ORDER_STATUS,
        t.SERVICE_DURATION,
        u.USER_ID as CUSTOM_ID,
        u.REAL_NAME,
        uu.USER_ID as SERVICE_PERSON_ID,
        uu.REAL_NAME as SERVICE_PERSON_REAL_NAME,
        t.SERVICE_BEGIN_TIME
    from
        t_task t left join t_user u on t.CUSTOM_ID = u.USER_ID
        left join t_user uu on t.SERVICE_PERSON_ID = uu.USER_ID
        left join t_dict d on t.SERVICE_CATEGORY_CODE = d.code and t.DICT_TYPE_CODE = d.type
     <where>
        <if test="serviceCategoryCodes != null and serviceCategoryCodes.size > 0">
           <foreach collection="serviceCategoryCodes" item="serviceCategoryCode" open="and (" close=")" separator="or">
             t.SERVICE_CATEGORY_CODE = #{serviceCategoryCode,jdbcType=VARCHAR}
           </foreach>
        </if>
        <if test="serviceCategoryCodes.isEmpty()">
          t.SERVICE_CATEGORY_CODE = null
        </if>
        <if test="orderStatus != null and orderStatus.size > 0">
           <foreach collection="orderStatus" item="currentOrderStatus" open="and (" close=")" separator="or">
           		<if test="currentOrderStatus == 2">
           			t.ORDER_STATUS = #{currentOrderStatus,jdbcType=TINYINT} or t.ORDER_STATUS = 5
           		</if>
             	<if test="currentOrderStatus != 2">
          			t.ORDER_STATUS = #{currentOrderStatus,jdbcType=TINYINT}
             	</if>
           </foreach>
        </if>
        <if test="orderStatus.isEmpty()">
          and t.ORDER_STATUS = null
        </if>
        <if test="abnormalOrder != null and abnormalOrder.size > 0">
           <foreach collection="abnormalOrder" item="currentAbnormalOrder" open="and (" close=")" separator="or">
             <if test="currentAbnormalOrder == 0"> 
		        t.ID 
		        not in 
		        (select 
		        	t.ID 
	       		from t_task t left join t_user u on t.CUSTOM_ID = u.USER_ID
        		left join t_user uu on t.SERVICE_PERSON_ID = uu.USER_ID
        		left join t_dict d on t.SERVICE_CATEGORY_CODE = d.code and t.DICT_TYPE_CODE = d.type
        		where ((isnull(SERVICE_BEGIN_TIME) and 
   					(now() > date_add(concat(date_format(ORDER_DATE, '%Y-%m-%d '), 
                           date_format(ORDER_BEGIN_TIME, '%T')),
                           interval 10 minute)))
	            or 
	          	((not isnull(SERVICE_BEGIN_TIME)) and 
	              isnull(SERVICE_END_TIME) and 
	              (now() > 
	                  date_add(
	                    concat(date_format(ORDER_DATE, '%Y-%m-%d '), 
	                           date_format(ORDER_END_TIME, '%T')),
	                           interval 10 minute)))) )
             </if>
             <if test="currentAbnormalOrder == 1">
             	((isnull(SERVICE_BEGIN_TIME) and 
   					(now() > date_add(concat(date_format(ORDER_DATE, '%Y-%m-%d '), 
                           date_format(ORDER_BEGIN_TIME, '%T')),
                           interval 10 minute)))
	            or 
	          	((not isnull(SERVICE_BEGIN_TIME)) and 
	              isnull(SERVICE_END_TIME) and 
	              (now() > 
	                  date_add(
	                    concat(date_format(ORDER_DATE, '%Y-%m-%d '), 
	                           date_format(ORDER_END_TIME, '%T')),
	                           interval 10 minute)))) 
             </if>
           </foreach>
        </if>
        <if test="abnormalOrder.isEmpty()">
          and 1 == 2
        </if>
        <if test="orderNo != null and orderNo != ''">
          and t.ORDER_NO like CONCAT(CONCAT('%',#{orderNo,jdbcType=VARCHAR}),'%') 
        </if>
        <if test="customUserNumber != null and customUserNumber != ''">
          and u.USER_NUMBER like CONCAT(CONCAT('%',#{customUserNumber,jdbcType=INTEGER}),'%') and u.USER_TYPE = 1
        </if>
        <if test="servicePersonUserNumber != null and servicePersonUserNumber != ''">
          and uu.USER_NUMBER like CONCAT(CONCAT('%',#{servicePersonUserNumber,jdbcType=INTEGER}),'%') and uu.USER_TYPE = 2
        </if>
        <if test="customRealName != null and customRealName != ''">
          and u.REAL_NAME = #{customRealName,jdbcType=VARCHAR} and u.USER_TYPE = 1
        </if>
        <if test="servicePersonRealName != null and servicePersonRealName != ''">
          and uu.REAL_NAME = #{servicePersonRealName,jdbcType=VARCHAR} and uu.USER_TYPE = 2
        </if>
        <if test="customBirthday != null">
          and u.BIRTHDAY = #{customBirthday,jdbcType=DATE} and u.USER_TYPE = 1
        </if>
        <if test="servicePersonBirthday != null">
          and uu.BIRTHDAY = #{servicePersonBirthday,jdbcType=DATE} and uu.USER_TYPE = 2
        </if>
        <if test="customIdCard != null and customIdCard != ''">
          and u.ID_CARD = #{customIdCard,jdbcType=VARCHAR} and u.USER_TYPE = 1
        </if>
        <if test="servicePersonIdCard != null and servicePersonIdCard != ''">
          and uu.ID_CARD = #{servicePersonIdCard,jdbcType=VARCHAR} and uu.USER_TYPE = 2
        </if>
        <if test="customMobile != null and customMobile != ''">
          and u.MOBILE = #{customMobile,jdbcType=VARCHAR} and u.USER_TYPE = 1
        </if>
        <if test="servicePersonMobile != null and servicePersonMobile != ''">
          and uu.MOBILE = #{servicePersonMobile,jdbcType=VARCHAR} and uu.USER_TYPE = 2
        </if>
        <if test="orderDateFrom != null">
          and date_format(t.ORDER_DATE,'%Y-%m-%d') &gt;= date_format(#{orderDateFrom,jdbcType=DATE},'%Y-%m-%d')
        </if>
        <if test="orderDateTo != null">
          and date_format(t.ORDER_DATE,'%Y-%m-%d') &lt;= date_format(#{orderDateTo,jdbcType=DATE},'%Y-%m-%d')
        </if>
        <if test="orderDurationFrom != null and orderDurationFrom != ''">
          and t.ORDER_DURATION &gt;= #{orderDurationFrom,jdbcType=VARCHAR}
        </if>
        <if test="orderDurationTo != null and orderDurationTo != ''">
          and t.ORDER_DURATION &lt;= #{orderDurationTo,jdbcType=VARCHAR}
        </if>
        <if test="orderBeginTimeFrom != null">
          and date_format(t.ORDER_BEGIN_TIME,'%T') &gt;= #{orderBeginTimeFrom,jdbcType=TIME}
        </if>
        <if test="orderBeginTimeTo != null">
          and date_format(t.ORDER_BEGIN_TIME,'%T') &lt;= #{orderBeginTimeTo,jdbcType=TIME}
        </if>
        and t.DICT_TYPE_CODE = 'SERVER_TYPE'
    </where>
    order by t.ORDER_NO asc
  </select>
  
  <!-- 获取任务管理页预约总时长信息 -->
  <select id="selectTaskTotalOrderDuration" parameterType="cn.com.dbridge.lifecare.dao.po.TaskManagePO" resultType="java.lang.Integer">
  	select
        sum(t.ORDER_DURATION)
    from
        t_task t left join t_user u on t.CUSTOM_ID = u.USER_ID
        left join t_user uu on t.SERVICE_PERSON_ID = uu.USER_ID
        left join t_dict d on t.SERVICE_CATEGORY_CODE = d.code and t.DICT_TYPE_CODE = d.type
     <where>
        <if test="serviceCategoryCodes != null and serviceCategoryCodes.size > 0">
           <foreach collection="serviceCategoryCodes" item="serviceCategoryCode" open="and (" close=")" separator="or">
             t.SERVICE_CATEGORY_CODE = #{serviceCategoryCode,jdbcType=VARCHAR}
           </foreach>
        </if>
        <if test="serviceCategoryCodes.isEmpty()">
          t.SERVICE_CATEGORY_CODE = null
        </if>
        <if test="orderStatus != null and orderStatus.size > 0">
           <foreach collection="orderStatus" item="currentOrderStatus" open="and (" close=")" separator="or">
           		<if test="currentOrderStatus == 2">
           			t.ORDER_STATUS = #{currentOrderStatus,jdbcType=TINYINT} or t.ORDER_STATUS = 5
           		</if>
             	<if test="currentOrderStatus != 2">
          			t.ORDER_STATUS = #{currentOrderStatus,jdbcType=TINYINT}
             	</if>
           </foreach>
        </if>
        <if test="orderStatus.isEmpty()">
          and t.ORDER_STATUS = null
        </if>
        <if test="abnormalOrder != null">
           <foreach collection="abnormalOrder" item="currentAbnormalOrder" open="and (" close=")" separator="or">
             <if test="currentAbnormalOrder == 0"> 
		        t.ID 
		        not in 
		        (select 
		        	t.ID 
	       		from t_task t left join t_user u on t.CUSTOM_ID = u.USER_ID
        		left join t_user uu on t.SERVICE_PERSON_ID = uu.USER_ID
        		left join t_dict d on t.SERVICE_CATEGORY_CODE = d.code and t.DICT_TYPE_CODE = d.type
        		where ((isnull(SERVICE_BEGIN_TIME) and 
   					(now() > date_add(concat(date_format(ORDER_DATE, '%Y-%m-%d '), 
                           date_format(ORDER_BEGIN_TIME, '%T')),
                           interval 10 minute)))
	            or 
	          	((not isnull(SERVICE_BEGIN_TIME)) and 
	              isnull(SERVICE_END_TIME) and 
	              (now() > 
	                  date_add(
	                    concat(date_format(ORDER_DATE, '%Y-%m-%d '), 
	                           date_format(ORDER_END_TIME, '%T')),
	                           interval 10 minute)))) )
             </if>
             <if test="currentAbnormalOrder == 1">
             	((isnull(SERVICE_BEGIN_TIME) and 
   					(now() > date_add(concat(date_format(ORDER_DATE, '%Y-%m-%d '), 
                           date_format(ORDER_BEGIN_TIME, '%T')),
                           interval 10 minute)))
	            or 
	          	((not isnull(SERVICE_BEGIN_TIME)) and 
	              isnull(SERVICE_END_TIME) and 
	              (now() > 
	                  date_add(
	                    concat(date_format(ORDER_DATE, '%Y-%m-%d '), 
	                           date_format(ORDER_END_TIME, '%T')),
	                           interval 10 minute)))) 
             </if>
           </foreach>
        </if>
        <if test="abnormalOrder.isEmpty()">
          and 1 == 2
        </if>
        <if test="orderNo != null and orderNo != ''">
          and t.ORDER_NO like CONCAT(CONCAT('%',#{orderNo,jdbcType=VARCHAR}),'%') 
        </if>
        <if test="customUserNumber != null and customUserNumber != ''">
          and u.USER_NUMBER like CONCAT(CONCAT('%',#{customUserNumber,jdbcType=INTEGER}),'%') and u.USER_TYPE = 1
        </if>
        <if test="servicePersonUserNumber != null and servicePersonUserNumber != ''">
          and uu.USER_NUMBER like CONCAT(CONCAT('%',#{servicePersonUserNumber,jdbcType=INTEGER}),'%') and uu.USER_TYPE = 2
        </if>
        <if test="customRealName != null and customRealName != ''">
          and u.REAL_NAME = #{customRealName,jdbcType=VARCHAR} and u.USER_TYPE = 1
        </if>
        <if test="servicePersonRealName != null and servicePersonRealName != ''">
          and uu.REAL_NAME = #{servicePersonRealName,jdbcType=VARCHAR} and uu.USER_TYPE = 2
        </if>
        <if test="customBirthday != null">
          and u.BIRTHDAY = #{customBirthday,jdbcType=DATE} and u.USER_TYPE = 1
        </if>
        <if test="servicePersonBirthday != null">
          and uu.BIRTHDAY = #{servicePersonBirthday,jdbcType=DATE} and uu.USER_TYPE = 2
        </if>
        <if test="customIdCard != null and customIdCard != ''">
          and u.ID_CARD = #{customIdCard,jdbcType=VARCHAR} and u.USER_TYPE = 1
        </if>
        <if test="servicePersonIdCard != null and servicePersonIdCard != ''">
          and uu.ID_CARD = #{servicePersonIdCard,jdbcType=VARCHAR} and uu.USER_TYPE = 2
        </if>
        <if test="customMobile != null and customMobile != ''">
          and u.MOBILE = #{customMobile,jdbcType=VARCHAR} and u.USER_TYPE = 1
        </if>
        <if test="servicePersonMobile != null and servicePersonMobile != ''">
          and uu.MOBILE = #{servicePersonMobile,jdbcType=VARCHAR} and uu.USER_TYPE = 2
        </if>
        <if test="orderDateFrom != null">
          and date_format(t.ORDER_DATE,'%Y-%m-%d') &gt;= date_format(#{orderDateFrom,jdbcType=DATE},'%Y-%m-%d')
        </if>
        <if test="orderDateTo != null">
          and date_format(t.ORDER_DATE,'%Y-%m-%d') &lt;= date_format(#{orderDateTo,jdbcType=DATE},'%Y-%m-%d')
        </if>
        <if test="orderDurationFrom != null and orderDurationFrom != ''">
          and t.ORDER_DURATION &gt;= #{orderDurationFrom,jdbcType=VARCHAR}
        </if>
        <if test="orderDurationTo != null and orderDurationTo != ''">
          and t.ORDER_DURATION &lt;= #{orderDurationTo,jdbcType=VARCHAR}
        </if>
        <if test="orderBeginTimeFrom != null">
          and date_format(t.ORDER_BEGIN_TIME,'%T') &gt;= #{orderBeginTimeFrom,jdbcType=TIME}
        </if>
        <if test="orderBeginTimeTo != null">
          and date_format(t.ORDER_BEGIN_TIME,'%T') &lt;= #{orderBeginTimeTo,jdbcType=TIME}
        </if>
        and t.DICT_TYPE_CODE = 'SERVER_TYPE'
    </where>
  </select>
  
  <!-- 获取任务管理页服务总时长信息 -->
  <select id="selectTaskTotalServiceDuration" parameterType="cn.com.dbridge.lifecare.dao.po.TaskManagePO" resultType="java.lang.Integer">
  	select
        sum(t.SERVICE_DURATION)
    from
        t_task t left join t_user u on t.CUSTOM_ID = u.USER_ID
        left join t_user uu on t.SERVICE_PERSON_ID = uu.USER_ID
        left join t_dict d on t.SERVICE_CATEGORY_CODE = d.code and t.DICT_TYPE_CODE = d.type
    <where>
        <if test="serviceCategoryCodes != null and serviceCategoryCodes.size > 0">
           <foreach collection="serviceCategoryCodes" item="serviceCategoryCode" open="and (" close=")" separator="or">
             t.SERVICE_CATEGORY_CODE = #{serviceCategoryCode,jdbcType=VARCHAR}
           </foreach>
        </if>
        <if test="serviceCategoryCodes.isEmpty()">
           t.SERVICE_CATEGORY_CODE = null
        </if>
        <if test="orderStatus != null and orderStatus.size > 0">
           <foreach collection="orderStatus" item="currentOrderStatus" open="and (" close=")" separator="or">
           		<if test="currentOrderStatus == 2">
           			t.ORDER_STATUS = #{currentOrderStatus,jdbcType=TINYINT} or t.ORDER_STATUS = 5
           		</if>
             	<if test="currentOrderStatus != 2">
          			t.ORDER_STATUS = #{currentOrderStatus,jdbcType=TINYINT}
             	</if>
           </foreach>
        </if>
        <if test="orderStatus.isEmpty()">
          and t.ORDER_STATUS = null
        </if>
		<if test="abnormalOrder != null">
           <foreach collection="abnormalOrder" item="currentAbnormalOrder" open="and (" close=")" separator="or">
             <if test="currentAbnormalOrder == 0"> 
		        t.ID 
		        not in 
		        (select 
		        	t.ID 
	       		from t_task t left join t_user u on t.CUSTOM_ID = u.USER_ID
        		left join t_user uu on t.SERVICE_PERSON_ID = uu.USER_ID
        		left join t_dict d on t.SERVICE_CATEGORY_CODE = d.code and t.DICT_TYPE_CODE = d.type
        		where ((isnull(SERVICE_BEGIN_TIME) and 
   					(now() > date_add(concat(date_format(ORDER_DATE, '%Y-%m-%d '), 
                           date_format(ORDER_BEGIN_TIME, '%T')),
                           interval 10 minute)))
	            or 
	          	((not isnull(SERVICE_BEGIN_TIME)) and 
	              isnull(SERVICE_END_TIME) and 
	              (now() > 
	                  date_add(
	                    concat(date_format(ORDER_DATE, '%Y-%m-%d '), 
	                           date_format(ORDER_END_TIME, '%T')),
	                           interval 10 minute)))) )
             </if>
             <if test="currentAbnormalOrder == 1">
             	((isnull(SERVICE_BEGIN_TIME) and 
   					(now() > date_add(concat(date_format(ORDER_DATE, '%Y-%m-%d '), 
                           date_format(ORDER_BEGIN_TIME, '%T')),
                           interval 10 minute)))
	            or 
	          	((not isnull(SERVICE_BEGIN_TIME)) and 
	              isnull(SERVICE_END_TIME) and 
	              (now() > 
	                  date_add(
	                    concat(date_format(ORDER_DATE, '%Y-%m-%d '), 
	                           date_format(ORDER_END_TIME, '%T')),
	                           interval 10 minute)))) 
             </if>
           </foreach>
        </if>
        <if test="abnormalOrder.isEmpty()">
          and 1 == 2
        </if>
        <if test="orderNo != null and orderNo != ''">
          and t.ORDER_NO like CONCAT(CONCAT('%',#{orderNo,jdbcType=VARCHAR}),'%') 
        </if>
        <if test="customUserNumber != null and customUserNumber != ''">
          and u.USER_NUMBER like CONCAT(CONCAT('%',#{customUserNumber,jdbcType=INTEGER}),'%') and u.USER_TYPE = 1
        </if>
        <if test="servicePersonUserNumber != null and servicePersonUserNumber != ''">
          and uu.USER_NUMBER like CONCAT(CONCAT('%',#{servicePersonUserNumber,jdbcType=INTEGER}),'%') and uu.USER_TYPE = 2
        </if>
        <if test="customRealName != null and customRealName != ''">
          and u.REAL_NAME = #{customRealName,jdbcType=VARCHAR} and u.USER_TYPE = 1
        </if>
        <if test="servicePersonRealName != null and servicePersonRealName != ''">
          and uu.REAL_NAME = #{servicePersonRealName,jdbcType=VARCHAR} and uu.USER_TYPE = 2
        </if>
        <if test="customBirthday != null">
          and u.BIRTHDAY = #{customBirthday,jdbcType=DATE} and u.USER_TYPE = 1
        </if>
        <if test="servicePersonBirthday != null">
          and uu.BIRTHDAY = #{servicePersonBirthday,jdbcType=DATE} and uu.USER_TYPE = 2
        </if>
        <if test="customIdCard != null and customIdCard != ''">
          and u.ID_CARD = #{customIdCard,jdbcType=VARCHAR} and u.USER_TYPE = 1
        </if>
        <if test="servicePersonIdCard != null and servicePersonIdCard != ''">
          and uu.ID_CARD = #{servicePersonIdCard,jdbcType=VARCHAR} and uu.USER_TYPE = 2
        </if>
        <if test="customMobile != null and customMobile != ''">
          and u.MOBILE = #{customMobile,jdbcType=VARCHAR} and u.USER_TYPE = 1
        </if>
        <if test="servicePersonMobile != null and servicePersonMobile != ''">
          and uu.MOBILE = #{servicePersonMobile,jdbcType=VARCHAR} and uu.USER_TYPE = 2
        </if>
        <if test="orderDateFrom != null">
          and date_format(t.ORDER_DATE,'%Y-%m-%d') &gt;= date_format(#{orderDateFrom,jdbcType=DATE},'%Y-%m-%d')
        </if>
        <if test="orderDateTo != null">
          and date_format(t.ORDER_DATE,'%Y-%m-%d') &lt;= date_format(#{orderDateTo,jdbcType=DATE},'%Y-%m-%d')
        </if>
        <if test="orderDurationFrom != null and orderDurationFrom != ''">
          and t.ORDER_DURATION &gt;= #{orderDurationFrom,jdbcType=VARCHAR}
        </if>
        <if test="orderDurationTo != null and orderDurationTo != ''">
          and t.ORDER_DURATION &lt;= #{orderDurationTo,jdbcType=VARCHAR}
        </if>
        <if test="orderBeginTimeFrom != null">
          and date_format(t.ORDER_BEGIN_TIME,'%h:%i:%s') &gt;= #{orderBeginTimeFrom,jdbcType=TIME}
        </if>
        <if test="orderBeginTimeTo != null">
          and date_format(t.ORDER_BEGIN_TIME,'%h:%i:%s') &lt;= #{orderBeginTimeTo,jdbcType=TIME}
        </if>
        and t.DICT_TYPE_CODE = 'SERVER_TYPE'
    </where>
  </select>
   
   <!-- 根据主键更新 -->
  <update id="updateByPrimaryKey" parameterType="cn.com.dbridge.lifecare.dao.po.TaskPO" >
   update t_task
    <set >
      <if test="id != null" >
        ID = #{id,jdbcType=INTEGER},
      </if>
      <if test="orderNo != null" >
        ORDER_NO = #{orderNo,jdbcType=VARCHAR},
      </if>
      <if test="customId != null" >
        CUSTOM_ID = #{customId,jdbcType=INTEGER},
      </if>
      <if test="servicePersonId != null" >
        SERVICE_PERSON_ID = #{servicePersonId,jdbcType=INTEGER},
      </if>
      <if test="dictTypeCode != null" >
        DICT_TYPE_CODE = #{dictTypeCode,jdbcType=INTEGER},
      </if>
      <if test="serviceCategoryCode != null" >
        SERVICE_CATEGORY_CODE = #{serviceCategoryCode,jdbcType=VARCHAR},
      </if>
      <if test="sexRequire != null" >
        SEX_REQUIRE = #{sexRequire,jdbcType=TINYINT},
      </if>
      <if test="districtId != null">
        DISTRICT_ID = {districtId,jdbcType=INTEGER},
      </if>
      <if test="streetId != null">
        STREET_ID = {streetId,jdbcType=INTEGER},
      </if>
      <if test="orderAddr != null" >
        ORDER_ADDR = #{orderAddr,jdbcType=VARCHAR},
      </if>
      <if test="orderDate != null" >
        ORDER_DATE = #{orderDate,jdbcType=DATE},
      </if>
      <if test="orderDuration != null" >
        ORDER_DURATION = #{orderDuration,jdbcType=DATE},
      </if>
      <if test="orderBeginTime != null" >
        ORDER_BEGIN_TIME = #{orderBeginTime,jdbcType=TIME},
      </if>
      <if test="orderEndTime != null" >
        ORDER_END_TIME = #{orderEndTime,jdbcType=TIME},
      </if>
      <if test="content != null" >
        CONTENT = #{content,jdbcType=VARCHAR},
      </if>
      <if test="remark != null" >
        REMARK = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="serviceBeginTime != null" >
        SERVICE_BEGIN_TIME = #{serviceBeginTime,jdbcType=TIME},
      </if>
      <if test="serviceEndTime != null" >
        SERVICE_END_TIME = #{serviceEndTime,jdbcType=TIME},
      </if>
      <if test="serviceDuration != null" >
        SERVICE_DURATION = #{serviceDuration,jdbcType=VARCHAR},
      </if>
      <if test="serviceDesc != null" >
        SERVICE_DESC = #{serviceDesc,jdbcType=VARCHAR},
      </if>
      <if test="orderStatus != null" >
        ORDER_STATUS = #{orderStatus,jdbcType=TINYINT},
      </if>
      <if test="cancelReson != null" >
        CANCEL_RESON = #{cancelReson,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null" >
        CREATE_TIME = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="createBy != null" >
        CREATE_BY = #{createBy,jdbcType=INTEGER},
      </if>
      <if test="updateTime != null" >
        UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateBy != null" >
        UPDATE_BY = #{updateBy,jdbcType=INTEGER}
      </if>
    </set>
    where ID = #{id,jdbcType=INTEGER}
  </update>
  
  <!-- 根据任务编号更新 -->
  <update id="updateByTaskId" parameterType="cn.com.dbridge.lifecare.dao.po.TaskPO" >
   update t_task
    <set >
      <if test="id != null" >
        ID = #{id,jdbcType=INTEGER},
      </if>
      <if test="orderNo != null" >
        ORDER_NO = #{orderNo,jdbcType=VARCHAR},
      </if>
      <if test="customId != null" >
        CUSTOM_ID = #{customId,jdbcType=INTEGER},
      </if>
      <if test="servicePersonId != null" >
        SERVICE_PERSON_ID = #{servicePersonId,jdbcType=INTEGER},
      </if>
      <if test="servicePersonId == null" >
      	SERVICE_PERSON_ID = null,
      </if>
      <if test="dictTypeCode != null" >
        DICT_TYPE_CODE = #{dictTypeCode,jdbcType=INTEGER},
      </if>
      <if test="serviceCategoryCode != null" >
        SERVICE_CATEGORY_CODE = #{serviceCategoryCode,jdbcType=VARCHAR},
      </if>
      <if test="sexRequire != null" >
        SEX_REQUIRE = #{sexRequire,jdbcType=TINYINT},
      </if>
      <if test="districtId != null">
        DISTRICT_ID = {districtId,jdbcType=INTEGER},
      </if>
      <if test="streetId != null">
        STREET_ID = {streetId,jdbcType=INTEGER},
      </if>
      <if test="orderAddr != null" >
        ORDER_ADDR = #{orderAddr,jdbcType=VARCHAR},
      </if>
      <if test="orderDate != null" >
        ORDER_DATE = #{orderDate,jdbcType=DATE},
      </if>
      <if test="orderDuration != null" >
        ORDER_DURATION = #{orderDuration,jdbcType=DATE},
      </if>
      <if test="orderBeginTime != null" >
        ORDER_BEGIN_TIME = #{orderBeginTime,jdbcType=TIME},
      </if>
      <if test="orderEndTime != null" >
        ORDER_END_TIME = #{orderEndTime,jdbcType=TIME},
      </if>
      <if test="content != null" >
        CONTENT = #{content,jdbcType=VARCHAR},
      </if>
      <if test="remark != null" >
        REMARK = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="serviceBeginTime != null" >
        SERVICE_BEGIN_TIME = #{serviceBeginTime,jdbcType=TIME},
      </if>
      <if test="serviceEndTime != null" >
        SERVICE_END_TIME = #{serviceEndTime,jdbcType=TIME},
      </if>
      <if test="serviceBeginTime == null" >
        SERVICE_BEGIN_TIME = null,
      </if>
      <if test="serviceEndTime == null" >
        SERVICE_END_TIME = null,
      </if>
      <if test="serviceDuration != null" >
        SERVICE_DURATION = #{serviceDuration,jdbcType=VARCHAR},
      </if>
      <if test="serviceDesc != null" >
        SERVICE_DESC = #{serviceDesc,jdbcType=VARCHAR},
      </if>
      <if test="serviceDesc == null" >
        SERVICE_DESC = null,
      </if>
      <if test="orderStatus != null" >
        ORDER_STATUS = #{orderStatus,jdbcType=TINYINT},
      </if>
      <if test="cancelReson != null" >
        CANCEL_RESON = #{cancelReson,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null" >
        CREATE_TIME = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="createBy != null" >
        CREATE_BY = #{createBy,jdbcType=INTEGER},
      </if>
      <if test="updateTime != null" >
        UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateBy != null" >
        UPDATE_BY = #{updateBy,jdbcType=INTEGER}
      </if>
    </set>
    where ID = #{id,jdbcType=INTEGER}
  </update>
  
  <!-- 获取任务编号含有指定内容的任务 -->
  <select id="selectTaskLikeOrderNo"  parameterType="cn.com.dbridge.lifecare.dao.po.TaskPO"  resultMap="BaseResultMap">
    select
      ORDER_NO
    from
      t_task
    where
      ORDER_NO like CONCAT(CONCAT('%',#{orderNo,jdbcType=VARCHAR}),'%')
  </select>
  
  	<!-- （小程序）获取任务 -->
    <select id="wxSelectTask"  resultType="cn.com.dbridge.lifecare.dao.po.WxTaskQueryPO">
  		SELECT
			t_task.ID AS taskId,
			t_user.REAL_NAME as realName,
			t_user.MOBILE as mobile,
			t_dict.NAME AS serviceCategoryName,
			t_dict.description AS serviceCategoryColor,
			t_task.ORDER_NO AS taskNo,
			t_user.SEX AS sex,
			t_task.ORDER_DATE AS orderDate,
			t_task.ORDER_BEGIN_TIME AS orderBeginTime,
			t_task.ORDER_END_TIME AS orderEndTime,
			t_user.STREET_VILLAGE AS streetVillage,
			t_user.BUILDING_NO AS building,
			t_district.DISTRICT_NAME AS districtName,
			t_task.ORDER_STATUS as orderStatus,
			t_task.CUSTOM_ID as customId,
			t_user.IMG as img,
			t_user.BIRTHDAY AS birthday
	FROM
		t_task
		LEFT JOIN t_user ON t_task.CUSTOM_ID = t_user.USER_ID
		LEFT JOIN t_district ON t_user.DISTRICT_ID = t_district.DISTRICT_ID
		LEFT JOIN t_dict ON t_dict.CODE = t_task.SERVICE_CATEGORY_CODE
	WHERE t_dict.type = 'SERVER_TYPE'
		<if test="servicePersonId != null">
			AND  t_task.SERVICE_PERSON_ID =#{servicePersonId,jdbcType=INTEGER}
		</if>
		<if test="orderDate != null">
			AND DATE_FORMAT(t_task.ORDER_DATE,'%Y-%m-%d') = #{orderDate,jdbcType=TIMESTAMP}
		</if>
		<if test="orderStatus != null">
			AND t_task.ORDER_STATUS = #{orderStatus,jdbcType=TIMESTAMP}
		</if>
		<if test="customId != null">
			AND t_task.CUSTOM_ID = #{customId,jdbcType=INTEGER}
		</if>
		<if test="taskId != null">
			AND t_task.ID = #{taskId,jdbcType=INTEGER}
		</if>
		<!-- 用看看类型是1:我的任务的场合  --> 
		<if test='type != null and type == "1" '>
            AND t_task.ORDER_STATUS IN (2,3,5)
            AND t_task.SERVICE_PERSON_ID = #{loginUserId,jdbcType=INTEGER}  
        </if>
        <!-- 用看看类型是0：任务池的场合  --> 
        <if test='type != null and type == "0" '>
         	AND t_task.ORDER_STATUS = 1
	        <if test="sex != null and sex == 0">
	               AND t_task.SEX_REQUIRE in(0, 1)
	        </if>
	        <!-- 性别是1:女的场合 -->  
	       <if test="sex != null and sex == 1">
	          AND t_task.SEX_REQUIRE in(0, 2)
	       </if>
            AND  t_task.ORDER_DATE >= CURDATE()
        </if>
	ORDER BY t_task.ORDER_DATE ASC, t_task.ORDER_BEGIN_TIME ASC
  </select>
  
  <!-- （小程序）获取任务详细信息 -->
  <select id="wxSelectTaskDetail"  resultType="cn.com.dbridge.lifecare.dao.po.WxTaskQueryDetailPO">
        SELECT
            t_task.ID as taskId,
            t_user.REAL_NAME as realName,
            t_user.MOBILE as mobile,
            CONCAT(t_district.DISTRICT_NAME,t_user.STREET_VILLAGE,t_user.BUILDING_NO) AS orderAddr,
            t_task.CONTENT AS content,
            t_task.REMARK AS remark,
          t_task.ORDER_DURATION as orderDuration,
            t_task.ORDER_DATE as orderDate,
            t_task.ORDER_BEGIN_TIME as orderBeginTime,
            t_task.ORDER_END_TIME as orderEndTime,
            t_task.ORDER_STATUS as orderStatus,
            t_task.ORDER_NO as orderNo,
            t_task.CREATE_TIME as createTime,
            t_task.CUSTOM_ID customId,
            t_dict.name as serviceCategoryName
    FROM
        t_task LEFT join t_user on t_task.CUSTOM_ID = t_user.USER_ID
        LEFT JOIN t_district on t_user.DISTRICT_ID = t_district.DISTRICT_ID
        LEFT JOIN t_dict ON (t_task.SERVICE_CATEGORY_CODE = t_dict.code AND t_task.DICT_TYPE_CODE = t_dict.type)
    <where>
        <if test="taskId != null and taskId != ''">
            AND t_task.ID = #{taskId,jdbcType=INTEGER}
        </if>
    </where>
     ORDER BY t_task.CREATE_BY DESC
  </select>
  
  <!--  -->
  <select id="selectCalendarTask" resultType="cn.com.dbridge.lifecare.dao.po.WxQueryTaskCalenderPO" parameterType="cn.com.dbridge.lifecare.dao.po.WxQueryTaskCalenderPO"  >
    SELECT
        T.ORDER_DATE as orderDate
    FROM T_TASK T 
   <where>
         <!-- 用看看类型是1:我的任务的场合  --> 
         <if test='type != null and type == "1" '>
            AND T.ORDER_STATUS IN (2,3,5)
            AND T.SERVICE_PERSON_ID = #{loginUserId,jdbcType=INTEGER}  
        </if>
         <!-- 用看看类型是0：任务池的场合  --> 
         <if test='type != null and type == "0" '>
            AND T.ORDER_STATUS = 1
             <!-- 性别是0:男的场合 -->  
            <if test="sex != null and sex == 0">
               AND T.SEX_REQUIRE in(0, 1)
            </if>
             <!-- 性别是1:女的场合 -->  
            <if test="sex != null and sex == 1">
               AND T.SEX_REQUIRE in(0, 2)
            </if>
            AND  T.ORDER_DATE >= CURDATE()
        </if>
        <if test="orderDate != null">
            AND DATE_FORMAT(T.ORDER_DATE, '%Y-%m') = DATE_FORMAT(#{orderDate,jdbcType=DATE}, '%Y-%m') 
        </if>  
        AND T.ORDER_DATE is not null    
   </where>
   GROUP BY T.ORDER_DATE
   ORDER BY T.ORDER_DATE
  </select>
  
  <!-- 获取未查看任务 -->
  <select id="getNoSeeTaskCnt" resultType="java.lang.Integer" >
    SELECT
        COUNT(1)
    FROM T_TASK T 
   <where>
         <!-- 用看看类型是1:我的任务的场合  --> 
         <if test='type != null and type == "1" '>
            AND T.ORDER_STATUS IN (2,3,5)
            AND T.SERVICE_PERSON_ID = #{loginUserId,jdbcType=INTEGER}  
        </if>
         <!-- 用看看类型是 0：任务池的场合  --> 
         <if test='type != null and type == "0" '>
            AND T.ORDER_STATUS = 1
             <!-- 性别是0:男的场合 -->  
            <if test="sex != null and sex == 0">
               AND T.SEX_REQUIRE in(0, 1)
            </if>
             <!-- 性别是1:女的场合 -->  
            <if test="sex != null and sex == 1">
               AND T.SEX_REQUIRE in(0, 2)
            </if>                 
        </if>
        <if test="orderDate != null">
            AND T.ORDER_DATE = #{orderDate,jdbcType=DATE}
        </if> 
         AND NOT EXISTS(
             SELECT 1
             FROM T_USER_TASK_REAL UT
             WHERE UT.USER_ID = #{loginUserId,jdbcType=INTEGER}
                 AND UT.TASK_ID = T.ID
             <if test="type != null and type != '' ">
                 AND UT.TYPE = #{type,jdbcType=VARCHAR}
             </if>             
         )     
   </where>
  </select>
  
  <!-- 根据服务人员编号更新 -->
  <update id="updateServicePersonId" parameterType="cn.com.dbridge.lifecare.dao.po.WebUserSelectPO" >
   update t_task
    <set >
      <if test="userId != null" >
        SERVICE_PERSON_ID = #{userId,jdbcType=INTEGER},
      </if>
      <if test="loginUserId != null" >
        UPDATE_BY = #{loginUserId,jdbcType=INTEGER},
      </if>
      ORDER_STATUS = 5,
      UPDATE_TIME = NOW()
     </set>
    where ID = #{id,jdbcType=INTEGER}
  </update>
  
  <!-- 获取任务池信息 -->
  <select id="selectTaskPool" parameterType="cn.com.dbridge.lifecare.dao.po.TaskPoolPO" resultMap="TaskPoolResultMap">
      select 
          d.description,
          t.CUSTOM_ID,
          u.BIRTHDAY,
          u.SEX,
          t.ID,
          t.ORDER_NO,
          t.ORDER_DATE,
          t.ORDER_BEGIN_TIME,
          t.ORDER_END_TIME,
          t.SEX_REQUIRE,
          t.SERVICE_CATEGORY_CODE
      from 
          t_task t 
          left join t_user u on t.CUSTOM_ID = u.USER_ID
          left join t_dict d on t.SERVICE_CATEGORY_CODE = d.code and t.DICT_TYPE_CODE = d.type
      where 
          ORDER_DATE between #{orderDate,jdbcType=DATE} and date_add(#{orderDate,jdbcType=DATE}, interval 6 day)
          and SERVICE_PERSON_ID is null and t.DICT_TYPE_CODE = 'SERVER_TYPE' and t.ORDER_STATUS != 4 
          and t.ID 
		        not in 
		        (select 
		        	t.ID 
	       		from t_task t left join t_user u on t.CUSTOM_ID = u.USER_ID
        		left join t_user uu on t.SERVICE_PERSON_ID = uu.USER_ID
        		left join t_dict d on t.SERVICE_CATEGORY_CODE = d.code and t.DICT_TYPE_CODE = d.type
        		where ((isnull(SERVICE_BEGIN_TIME) and 
   					(now() > date_add(concat(date_format(ORDER_DATE, '%Y-%m-%d '), 
                           date_format(ORDER_BEGIN_TIME, '%T')),
                           interval 10 minute)))
	            or 
	          	((not isnull(SERVICE_BEGIN_TIME)) and 
	              isnull(SERVICE_END_TIME) and 
	              (now() > 
	                  date_add(
	                    concat(date_format(ORDER_DATE, '%Y-%m-%d '), 
	                           date_format(ORDER_END_TIME, '%T')),
	                           interval 10 minute)))) 
		        and
		        (ORDER_STATUS = 1 or ORDER_STATUS = 2 or ORDER_STATUS = 5))
		  order by u.STREET_VILLAGE_PINYIN asc
          ,t.ORDER_DATE asc
          ,t.ORDER_BEGIN_TIME asc
  </select>
         
  <!--  -->
  <select id="getUsedTaskCnt" resultType="java.lang.Integer" parameterType="java.lang.Integer" >
   SELECT 
    COUNT(1)
   FROM
    t_task
   WHERE
     (ORDER_STATUS IS NULL OR ORDER_STATUS = 1 OR ORDER_STATUS = 2)
     <if test="userId != null">
      AND (CUSTOM_ID = #{userId,jdbcType=INTEGER} OR SERVICE_PERSON_ID = #{userId,jdbcType=INTEGER})
     </if>          
  </select>
  
  <!-- 获取时间冲突任务数 -->
   <select id="getServiceTimeConflictTaskCnt" resultType="java.lang.Integer" parameterType="cn.com.dbridge.lifecare.dao.po.WebUserSelectPO" >
    select count(1) 
    from t_task t
    where t.SERVICE_PERSON_ID = #{userId,jdbcType=INTEGER}
     and t.ORDER_DATE = #{orderDate,jdbcType=DATE}
     and t.ORDER_STATUS in (2, 5)
     and t.ID != #{id,jdbcType=INTEGER}
     and (
           (
             T.ORDER_BEGIN_TIME <![CDATA[>=]]> #{orderBeginTime,jdbcType=TIME} 
             AND T.ORDER_BEGIN_TIME <![CDATA[<=]]> #{orderEndTime,jdbcType=TIME}  
            )
            OR
            (
             T.ORDER_END_TIME <![CDATA[>=]]> #{orderBeginTime,jdbcType=TIME} 
             AND T.ORDER_END_TIME <![CDATA[<=]]> #{orderEndTime,jdbcType=TIME}
            )
            OR
            (
             T.ORDER_BEGIN_TIME <![CDATA[<=]]> #{orderBeginTime,jdbcType=TIME}
             AND T.ORDER_END_TIME <![CDATA[>=]]> #{orderEndTime,jdbcType=TIME}
            )
         )
  </select> 
  
  <!-- 获取时间冲突任务数 -->
  <select id="selectTimeOverlapedTask"  resultType="java.lang.Integer" parameterType="cn.com.dbridge.lifecare.dao.po.WebUserSelectPO"  >
  	select 
  		count(*)
  	from 
  		t_task t
  	where 
  		t.SERVICE_PERSON_ID = #{userId,jdbcType=INTEGER}
  		and t.ID != #{id,jdbcType=INTEGER}
  		and t.ORDER_STATUS in (2,5)
  		and t.ORDER_DATE = #{orderDate,jdbcType=DATE}
  		and (
           (
             T.ORDER_BEGIN_TIME <![CDATA[>=]]> #{orderBeginTime,jdbcType=TIME} 
             AND T.ORDER_BEGIN_TIME <![CDATA[<=]]> #{orderEndTime,jdbcType=TIME}  
            )
            OR
            (
             T.ORDER_END_TIME <![CDATA[>=]]> #{orderBeginTime,jdbcType=TIME} 
             AND T.ORDER_END_TIME <![CDATA[<=]]> #{orderEndTime,jdbcType=TIME}
            )
            OR
            (
             T.ORDER_BEGIN_TIME <![CDATA[<=]]> #{orderBeginTime,jdbcType=TIME}
             AND T.ORDER_END_TIME <![CDATA[>=]]> #{orderEndTime,jdbcType=TIME}
            )
         )
  </select>
  
  <!-- 根据主键获取客户信息 -->
  <!-- <select id="selectCustomById" parameterType="java.lang.Integer" resultMap="UnassignedTaskListResultMap">
    select
        t.ORDER_NO,
        d.name,
        t.ORDER_BEGIN_TIME,
        t.ORDER_DURATION,
        u.REAL_NAME,
        u.MOBILE
    from
        t_task t left join t_user u on t.CUSTOM_ID = u.USER_ID
        left join t_dict_type dt on t.DICT_TYPE_CODE = dt.code
        left join t_dict d on t.SERVICE_CATEGORY_CODE = d.code and dt.code = d.type
    where
        t.ID = #{id,jdbcType=INTEGER}
  </select> -->
  
  <!-- 根据订单号获取服务人员信息 -->
  <!-- <select id="selectServicePersonByOrderNo" parameterType="java.lang.String" resultMap="ServicePersonResultMap">
    select 
        t.ORDER_DURATION,
        t.ORDER_NO,
        t.SERVICE_PERSON_ID,
        u.USER_NUMBER,
        u.REAL_NAME,
        u.MOBILE,
        d.DISTRICT_NAME,
        u.STREET_VILLAGE,
        u.BUILDING_NO,
        u.BIRTHDAY,
        u.SEX,
        u.USER_LEVEL,
        u.USER_STATUS
    from t_task t left join t_user u on t.SERVICE_PERSON_ID = u.USER_ID 
    left join t_district d on u.DISTRICT_ID = d.DISTRICT_ID
    where t.ORDER_NO = #{orderNo,jdbcType=VARCHAR}
  </select> -->
  
  <!-- （小程序）根据主键获取任务 -->
  <select id="wxSelectTaskByPrimaryKey" resultType="cn.com.dbridge.lifecare.dao.po.TaskPO">
   select 
        ID, 
        ORDER_NO as orderNo, 
        CUSTOM_ID as customId,
        SERVICE_PERSON_ID as servicePersonId, 
        SERVICE_CATEGORY_CODE as serviceCategoryCode, 
        SEX_REQUIRE as sexRequire, 
        ORDER_ADDR as orderAddr, 
        ORDER_DATE as orderDate, 
        ORDER_BEGIN_TIME as orderBeginTime, 
        ORDER_END_TIME as orderEndTime, 
        CONTENT as content, 
        REMARK as remark, 
        SERVICE_BEGIN_TIME as serviceBeginTime, 
        SERVICE_END_TIME as serviceEndTime, 
        SERVICE_DURATION as serviceDuration, 
        SERVICE_DESC as serviceDesc, 
        ORDER_STATUS as orderStatus, 
        CANCEL_RESON as cancelReson, 
        CREATE_TIME as createTime, 
        CREATE_BY as createBy, 
        UPDATE_TIME as updateTime, 
        UPDATE_BY as updateBy
    from t_task
    where ID = #{taskId,jdbcType=INTEGER}
  </select>
  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
  	delete from 
  		t_task
    where
        ID = #{id,jdbcType=INTEGER}
  </delete>
  
  <delete id="deleteTask" parameterType="cn.com.dbridge.lifecare.dao.po.TaskPO">
  	delete from 
  		t_task
    <where>
      <if test="id != null" >
        ID = #{id,jdbcType=INTEGER}
      </if>
      <if test="orderNo != null" >
        and ORDER_NO = #{orderNo,jdbcType=VARCHAR}
      </if>
      <if test="customId != null" >
        and CUSTOM_ID = #{customId,jdbcType=INTEGER}
      </if>
      <if test="servicePersonId != null" >
        and SERVICE_PERSON_ID = #{servicePersonId,jdbcType=INTEGER}
      </if>
      <if test="dictTypeCode != null" >
        and DICT_TYPE_CODE = #{dictTypeCode,jdbcType=INTEGER}
      </if>
      <if test="serviceCategoryCode != null" >
        and SERVICE_CATEGORY_CODE = #{serviceCategoryCode,jdbcType=VARCHAR},
      </if>
      <if test="sexRequire != null" >
        and SEX_REQUIRE = #{sexRequire,jdbcType=TINYINT}
      </if>
      <if test="districtId != null">
        and DISTRICT_ID = {districtId,jdbcType=INTEGER}
      </if>
      <if test="streetId != null">
        and STREET_ID = {streetId,jdbcType=INTEGER}
      </if>
      <if test="orderAddr != null" >
        and ORDER_ADDR = #{orderAddr,jdbcType=VARCHAR}
      </if>
      <if test="orderDate != null" >
        and ORDER_DATE = #{orderDate,jdbcType=DATE}
      </if>
      <if test="orderDuration != null" >
        and ORDER_DURATION = #{orderDuration,jdbcType=DATE}
      </if>
      <if test="orderBeginTime != null" >
        and ORDER_BEGIN_TIME = #{orderBeginTime,jdbcType=TIME}
      </if>
      <if test="orderEndTime != null" >
        and ORDER_END_TIME = #{orderEndTime,jdbcType=TIME}
      </if>
      <if test="content != null" >
        and CONTENT = #{content,jdbcType=VARCHAR}
      </if>
      <if test="remark != null" >
        and REMARK = #{remark,jdbcType=VARCHAR}
      </if>
      <if test="serviceBeginTime != null" >
        and SERVICE_BEGIN_TIME = #{serviceBeginTime,jdbcType=TIME}
      </if>
      <if test="serviceEndTime != null" >
        and SERVICE_END_TIME = #{serviceEndTime,jdbcType=TIME}
      </if>
      <if test="serviceDuration != null" >
        and SERVICE_DURATION = #{serviceDuration,jdbcType=VARCHAR}
      </if>
      <if test="serviceDesc != null" >
        and SERVICE_DESC = #{serviceDesc,jdbcType=VARCHAR}
      </if>
      <if test="orderStatus != null" >
        and ORDER_STATUS = #{orderStatus,jdbcType=TINYINT}
      </if>
      <if test="cancelReson != null" >
        and CANCEL_RESON = #{cancelReson,jdbcType=VARCHAR}
      </if>
      <if test="createTime != null" >
        and CREATE_TIME = #{createTime,jdbcType=TIMESTAMP}
      </if>
      <if test="createBy != null" >
        and CREATE_BY = #{createBy,jdbcType=INTEGER}
      </if>
      <if test="updateTime != null" >
        and UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP}
      </if>
      <if test="updateBy != null" >
        and UPDATE_BY = #{updateBy,jdbcType=INTEGER}
      </if>
    </where>
  </delete>
</mapper>